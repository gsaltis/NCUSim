/*!
 * Author: Jerman.Xie | xieguishi@126.com
 * Date: 2013.09
 * THis file includes: emerson.chart.js、emerson.config.js、emerson.control.js、emerson.page.js、emerson.validate.js
 * This file is compressed using YUI. 
 * Online YUI's url is "http://refresh-sf.com/yui/"
 * =================================================================================================================
 */


/*!
 * Author: Jerman.Xie | xieguishi@126.com
 * Date: 2013.09
 *
 * 绘制相关图表的方法汇集
 */
;var Chart={};Chart.canvasForIE=function(ele){if(Configs.Browser=="IE6"||Configs.Browser=="IE7"||Configs.Browser=="IE8"){ele=window.G_vmlCanvasManager.initElement(ele)}return ele};Chart.getArrayMax=function(arr){var Max=arr[0];for(var i=0,ilen=arr.length;i<ilen;i++){Max=Math.max(Max,arr[i])};return Max};Chart.transformAngle=function(angle){return(angle/360)*2*Math.PI};Chart.makeupZero=function(num){if(num<10){return"0"+num}else{return num}};Chart.ArraySameCount=[];Chart.AarryDeleteSame=function(arr){for(var i=0;i<arr.length;i++)for(var j=i+1;j<arr.length;j++)if(arr[i]===arr[j]){this.ArraySameCount.push(i);arr.splice(j,1);j--}else{}return arr.sort(function(a,b){return a-b})};Chart.drawCurve=function(target,options,data_y){var setting={canvas:{padding:[5,5,5,5],width:600,height:110},lines:{color:["#858585","#6CAFD9"],width:1},X:{value:[]},Y:{unit:"%",value:[0,25,50,75,100],follow:[false,0,0]},alarm:{value:[],color:["#a2ee00","#ffae00","#e35500","#ff0000"],width:1,midline:["#858585",2]},value:[],unit:"A",hasMax:true,hasMouse:true,hasKey:true,dateFormat:"MM-DD"};var that=this;var container=document.getElementById(target);$(container).html("");if($.type(options)!=="object"){alert(Language.Chart["001"]);return};if(!container){return}var $container=$(container);var nodata=false;function doNodata(value){nodata=true;var cvs2=$(container).find("canvas.curve-mouse")[0];if(cvs2){$(cvs2).off()}if(value==true){var Nodatas={};options=$.extend(true,{},Nodatas,options);options.value=[["1970/00/00 00:00:00","nodata"]]}$container.find("div.curve-date").hide();$container.find("canvas.curve-mouse").hide();$container.find("div.curve-max").hide();$container.find("div.curve-point").hide();$container.find("div.curve-x").hide();var NodataEle=document.createElement("div");NodataEle.className="curve-nodata";NodataEle.innerHTML=Language.Html["028"];$(container).append(NodataEle);if($.type(options['fn_nodata'])=="function"){options['fn_nodata']()}};if(!options["value"]){return false}if(options["value"].length==0){doNodata(true)}else{$container.find("div.curve-date").hide();$container.find("div.curve-nodata").remove();$container.find("canvas.curve-mouse").show();$container.find("div.curve-date").show();$container.find("div.curve-max").hide();$container.find("div.curve-x").show();if($.type(options['fn'])=="function"){options['fn']()}}Control.PromptEvent.TipRemove({remove:"Trend"});Control.PromptEvent.LoadingRemove({remove:target});setting=$.extend(true,{},setting,options);var canvas=setting.canvas;var scale=setting.scale;var alarm=setting.alarm;var V=setting.value;var X=setting.X;var Y=setting.Y;var unit=setting.unit;var V2=data_y?data_y.value:V;var cvs=document.createElement("canvas");cvs.id=target+"_canvas";cvs.className="curve-canvas";cvs.width=canvas.width;cvs.height=canvas.height;$(container).append(cvs);this.canvasForIE(cvs);var cxt=cvs.getContext("2d");cxt.canvas=null;cxt.clearRect(0,0,canvas.width,canvas.height);cxt.lineCap="round";cxt.save();if(Y.follow&&Y.follow[0]===true){var YMax=-Infinity,YMin=Infinity;for(var m=0,mlen=V.length;m<mlen;m++){if(V[m][1]==-273){continue}if(m==0){YMax=V[m][1];YMin=V[m][1]}YMax=Math.max(YMax,V[m][1]);YMin=Math.min(YMin,V[m][1])}if(Infinity==YMin){YMin=-45}if(-Infinity==YMax){YMax=70}YMin-=5;YMin=(YMin<=Y.follow[1])?Y.follow[1]:YMin;YMax+=5;YMax=(YMax>=Y.follow[2])?Y.follow[2]:YMax;var cz=Math.ceil((YMax-YMin)/5);Y.value=[];for(var i=0;i<6;i++){Y.value.push(parseInt(YMin+cz*i))}Y.value.sort(function(c,d){return c-d})}if(V.length==0){return}if(Configs.SystemTime!=""){var currentDateString=Configs.SystemTime.split(" ")[0]}else{var currentDateString=V[V.length-1][0].split(" ")[0]}for(var j=0;j<4;j++){var tempDate=new Date(currentDateString);X.value[j]=new Date(tempDate.setDate(tempDate.getDate()-j*10))}X.value.reverse();var canvas_width=canvas.width-(canvas.padding[1]+canvas.padding[3]);var canvas_height=canvas.height-(canvas.padding[0]+canvas.padding[2]);cxt.save();var xdiv=null;xdiv=document.createElement("div");xdiv.className="curve-x";$(container).append(xdiv);$(xdiv)[0].innerHTML='';cxt.strokeStyle=setting.lines.color[0];cxt.lineWidth=1;var span=null;var spanHTML="";for(var i=0,z=0,ilen=(X.value.length-1)*10+2;i<=ilen;i++){var xItem=(canvas_width-(canvas_width/ilen))/ilen;var x1=Math.floor(xItem*i)+0.5;if(i==0){continue};if(i%10==1){cxt.lineWidth=2;spanHTML=this.makeupZero(X.value[z].getMonth()+1)+"-"+this.makeupZero(X.value[z].getDate());if(!nodata){span=document.createElement("span");span.innerHTML=spanHTML;$(xdiv).append(span);$(span).css({"left":x1-$(span).width()/2})}z++}else{cxt.lineWidth=1}cxt.beginPath();cxt.moveTo(x1,0);cxt.lineTo(x1,canvas.height);cxt.stroke()}span=null;spanHTML=null;cxt.save();var Ylast=Y.value[Y.value.length-1]-Y.value[0];var YZeroLine=(canvas_height*(0-Y.value[0])/Ylast);var Yzero=Y.value[0];if(!nodata){var ydiv=null;ydiv=document.createElement("div");ydiv.className="curve-y";$(ydiv).css({"height":canvas.height});$(container).append(ydiv);var top="",yint="";for(var y=0,ylen=Y.value.length;y<ylen;y++){top=canvas.padding[0]+Math.floor(canvas_height-(Y.value[y]-Yzero)*canvas_height/Ylast)+0.5;yint=y==0?(Y.value[y]==0?"":Y.unit):Y.unit;span=document.createElement("span");span.innerHTML=Y.value[y]+yint;$(ydiv).append(span);$(span).css({"top":top-8})}cxt.save();top=null;yint=null}if(nodata){return}var ay="";if(alarm.value[0]<Y.value[0]){alarm.value[0]=Y.value[0]}if(alarm.value[alarm.value.length-1]>Y.value[Y.value.length-1]){alarm.value[alarm.value.length-1]=Y.value[Y.value.length-1]}for(var a=0,alen=alarm.value.length;a<alen;a++){ay=canvas.padding[0]+Math.floor(canvas_height-(alarm.value[a]-Yzero)*canvas_height/Ylast)+0.5;cxt.beginPath();cxt.lineWidth=alarm.width;cxt.strokeStyle=alarm.color[a];cxt.moveTo(alarm.width/2+Configs.ChartdrawCurve_Y[1],ay);cxt.lineTo(canvas_width-alarm.width/2-Configs.ChartdrawCurve_Y[1],ay);cxt.stroke();if(a==alen-1){cxt.save();cxt.beginPath();cxt.strokeStyle=alarm.midline[0];cxt.lineWidth=alarm.midline[1];cxt.moveTo(Configs.ChartdrawCurve_Y[0],1);cxt.lineTo(cvs.width-Configs.ChartdrawCurve_Y[3],1);cxt.moveTo(Configs.ChartdrawCurve_Y[0],cvs.height/2);cxt.lineTo(cvs.width-Configs.ChartdrawCurve_Y[3],cvs.height/2);cxt.moveTo(Configs.ChartdrawCurve_Y[0],cvs.height-1);cxt.lineTo(cvs.width-Configs.ChartdrawCurve_Y[3],cvs.height-1);cxt.stroke()}}ay=null;var allCount=32*24*60*60*1000;var currentDate=new Date(currentDateString);var firstCount=new Date(currentDate.setDate(currentDate.getDate()-31));cxt.save();cxt.strokeStyle=setting.lines.color[1];cxt.fillStyle=setting.lines.color[1];cxt.lineWidth=setting.lines.width;var maxPoint=-Infinity,maxIndex=Y.length-1;var minPoint=Infinity,minIndex=0;var startTime=X.value[0].getTime();var endTime=X.value[X.value.length-1].getTime()+24*60*60*1000;var curveDownLine=canvas.height-canvas.padding[2];var curveUpLine=canvas.padding[0];function getQx(ct){return Math.floor(((ct-firstCount)/allCount)*(canvas_width-canvas_width/ilen))+0.5}function getQy(vq){return canvas.padding[0]+Math.floor(canvas_height-(vq-Yzero)*canvas_height/Ylast)+0.5}var qx=getQx(new Date(V[0][0]).getTime());var qy=getQy(V[0][1]?V[0][1]:0);var redraw=false;if(V.length>1){function DrawPoints(q){cxt.beginPath();for(var qlen=V.length;q<qlen;q++){qx=getQx(new Date(V[q][0]).getTime());qy=getQy(V[q][1]);if(new Date(V[q][0]).getTime()>=startTime&&new Date(V[q][0]).getTime()<=endTime){maxPoint=Math.max(maxPoint,V[q][1]);minPoint=Math.min(minPoint,V[q][1])}if(V[q+1]){if((new Date(V[q+1][0]).getTime()-new Date(V[q][0]).getTime())>=2*60*60*1000){if(redraw){cxt.lineTo(qx,qy);cxt.stroke();cxt.arc(qx,qy,1,0,2*Math.PI,true);redraw=false}else{cxt.arc(qx,qy,1,0,2*Math.PI,true);cxt.fill()}q++;break}else{if(!redraw){cxt.moveTo(qx,qy);cxt.arc(qx,qy,1,0,2*Math.PI,true);cxt.fill();redraw=true}else{cxt.lineTo(qx,qy)}}}else{if(V[q-1]){if((new Date(V[q][0]).getTime()-new Date(V[q-1][0]).getTime())>=2*60*60*1000){cxt.arc(qx,qy,1,0,2*Math.PI,true);cxt.fill()}else{cxt.lineTo(qx,qy)}}}}cxt.stroke();cxt.save();if(q<qlen){DrawPoints(q)}}DrawPoints(0)}else{cxt.beginPath();cxt.fillStyle=setting.lines.color[1];if(new Date(V[0][0]).getTime()>=startTime&&new Date(V[0][0]).getTime()<=endTime){maxPoint=Math.max(maxPoint,V[0][1]);minPoint=Math.min(minPoint,V[0][1])}cxt.arc(qx,qy,2,0,2*Math.PI);cxt.fill()}qx=null;qy=null;var Ymax=Y.value[Y.value.length-1];var Ymin=Y.value[0];var ChartTip=$container.find("strong.curve-tip");if(Number(maxPoint)>Ymax||Number(minPoint)<Ymin){if(ChartTip[0]){ChartTip.show()}else{ChartTip=document.createElement("strong");ChartTip.className="curve-tip";ChartTip.innerHTML=Language.Chart["002"];$(container).append(ChartTip)}}else{$(ChartTip).hide()}var hasMax=setting.hasMax;var hasMouse=setting.hasMouse;if(hasMouse){if(!$(container).find("div.curve-point")[0]){var PointElement=document.createElement("div");PointElement.style.display="none";PointElement.className="curve-point";$(cvs).before(PointElement)}};if(hasMax){if(!$(container).find("div.curve-max")[0]){var MaxElement=document.createElement("div");MaxElement.className="curve-max";$(cvs).before(MaxElement)}};if(!$(container).find("div.curve-date")[0]){var DateElement=document.createElement("div");DateElement.className="curve-date";DateElement.innerHTML=Language.Chart["003"]+" "+setting.dateFormat;$container.append(DateElement)}var cvs2=$(container).find("canvas.curve-mouse")[0];if(!cvs2){var cvs2=document.createElement("canvas");cvs2.className="curve-mouse";$(cvs).before(cvs2)}cvs2.width=canvas.width;cvs2.height=canvas.height;this.canvasForIE(cvs2);var cxt2=cvs2.getContext("2d");cxt2.canvas=null;var CurveMax=MaxElement?$(MaxElement):$container.find("div.curve-max");var CurvePoint=PointElement?$(PointElement):$container.find("div.curve-point");if(hasMax){if(V[0][1]=="nodata"){return}var X_StartTime=X.value[0].getTime();var X_EndTime=X.value[X.value.length-1].getTime()+ +60*60*1000*24;var V_StartTime=new Date(V[0][0]).getTime();var V_EndTime=new Date(V[V.length-1][0]).getTime();if(V_StartTime>X_EndTime||V_EndTime<X_StartTime){doNodata();$(cvs2).off();cxt2.clearRect(0,0,canvas.width,canvas.height);return};function drawMax(){cxt2.beginPath();var max_value=[];var currentTime=0,qx=0,qy=0;for(var q=0,qlen=V.length;q<qlen;q++){currentTime=new Date(V[q][0]).getTime();if(currentTime>=startTime&&currentTime<=endTime){if(V[q][1]==maxPoint){maxIndex=q;qx=Math.floor(((currentTime-firstCount)/allCount)*(canvas_width-canvas.width/ilen))+0.5;qy=canvas.padding[0]+Math.floor(canvas_height-(V[q][1]-Yzero)*canvas_height/Ylast)+0.5;max_value.push([qx,qy,V[q][0],V[q][1]])}}};if(max_value.length>0){cxt2.beginPath();cxt2.fillStyle="#ff6600";cxt2.arc(max_value[max_value.length-1][0],max_value[max_value.length-1][1],4,0,2*Math.PI);if(CurveMax[0]){CurveMax.html("<p>"+Language.Html["026"]+":<span id='PeakCurrent'>"+(V2.peakCurrent?V2.peakCurrent[0]:V2[maxIndex][1])+"</span>"+unit+"</p><p>"+Pages.footer(Pages.changetime(max_value[max_value.length-1][2]),"page")+"</p>").css({"left":qx+50,"top":qy-25})};var left=qx+55+CurveMax.outerWidth(true);var trend_width=canvas.width;if(left>trend_width){CurveMax.css({"left":qx-CurveMax.outerWidth(true)+40})}CurveMax.show()}cxt2.fill();cxt2.save();currentTime=null;qx=null;qy=null};drawMax()}if(hasMouse){cxt2.strokeStyle="#E35500";cxt2.fillStyle="#E35500";var timeout=null;var time=endTime-startTime;this.MoveTimer=null;var that=this;var mouseX=0;var doc=$("html");$(cvs2).off().on("mousemove",function(event){if(mouseX==event.clientX){return}mouseX=event.clientX;CurveMax.hide();MovePoint(event,"keymove")}).on("mouseleave",function(){that.MoveTimer=setTimeout(function(){Configs.Trend.Enter=false;cxt2.clearRect(0,0,canvas.width,canvas.height);CurvePoint.hide();if(hasMax){drawMax()}$(doc).off("keydown")},200)}).on("mouseenter",function(event){clearTimeout(that.MoveTimer);Configs.Trend.Enter=true;CurveMax.hide();$(doc).off("keydown").on("keydown",function(event){var key=event.keyCode;if(!Configs.Trend.Enter){return}if(key==37){Configs.Trend.Point-=1}else if(key==39){Configs.Trend.Point+=1}if(Configs.Trend.Point<0){Configs.Trend.Point=0}else if(Configs.Trend.Point>V2.length-1){Configs.Trend.Point=V2.length-1}MovePoint(event,V2[Configs.Trend.Point])})});var MovePoint=function(event,NextPoint){var X_StartTime=X.value[0].getTime();var X_EndTime=X.value[X.value.length-1].getTime()+60*60*1000*24;var Key_Point=new Date(NextPoint[0]).getTime();if(!NextPoint){return};if(Key_Point<X_StartTime){Configs.Trend.Point++;return}else if(Key_Point>X_EndTime){Configs.Trend.Point--;return};var V_StartTime=new Date(V[0][0]).getTime();var V_EndTime=new Date(V[V.length-1][0]).getTime();if(V_StartTime>X_EndTime||V_EndTime<X_StartTime){return}var this_position=$(cvs2).offset();var m_left=event.clientX-this_position.left+17;var m_top=event.clientY-this_position.top;var currentSeconeds=startTime+parseInt(time*(m_left/cvs.width));var current=new Date(currentSeconeds);var Month=current.getMonth()+1;var day=current.getDate();var prev=0;var next=0;var np=0;var value="";var value_time="";if(NextPoint=="keymove"){for(var i=0,olen=V.length;i<olen;i++){var t=new Date(V[i][0]).getTime();if(t==currentSeconeds){np=i;break}if(currentSeconeds-t>=0){prev=i;np=prev;value=V2[np][1];value_time=V[np][0]}else{next=i;var prevDay=new Date(V[prev][0]),prevDay_month=prevDay.getMonth()+1,prevDay_day=prevDay.getDay,nextDay=new Date(V[next][0]),nextDay_month=nextDay.getMonth()+1,nextDay_day=nextDay.getDay;if(prevDay_month==nextDay_month){if(prevDay_day==day){np=prev}else if(nextDay_day==day){np=next}else{if(currentSeconeds-prevDay.getTime()>nextDay.getTime()-currentSeconeds){np=next}else{np=prev}}}else{if(currentSeconeds-prevDay.getTime()>=nextDay.getTime()-currentSeconeds){np=next}else{np=prev}}value=V2[np][1];value_time=V[np][0];break}};Configs.Trend.Point=np};if(NextPoint!="keymove"&&NextPoint){CurveMax.hide();value=NextPoint[1];value_time=NextPoint[0]};if($.trim(value)==""||$.trim(value_time)==""){CurvePoint.hide();if(hasMax){drawMax()}return};cxt2.clearRect(0,0,canvas.width,canvas.height);cxt2.beginPath();var currentTime=new Date(value_time).getTime();var x=Math.floor(((currentTime-firstCount)/allCount)*(canvas_width-canvas.width/ilen))+0.5;var yh=(NextPoint!=true&&NextPoint)?(V[Configs.Trend.Point][1]?V[Configs.Trend.Point][1]:0):(V[np][1]?V[np][1]:0);var y=canvas.padding[0]+Math.floor(canvas_height-(yh-Yzero)*canvas_height/Ylast)+0.5;cxt2.beginPath();cxt2.arc(x,y,3,0,2*Math.PI);cxt2.fill();if(container.id=="Trend"){value=value<0?0:value}CurvePoint.html("<span>"+Pages.footer(Pages.changetime(value_time),"page")+"<em>"+value+unit+"</em></span>").show()}}};Chart.Thermometer={height:0},Chart.drawThermometer=function(target,options){var setting={imgs:{fingerWidth:13,height:16,left:26,top:30},canvas:{width:null,height:null,Class:"thermometer-canvas"},thermometer:{width:127,height:6,top:34,fingerLeft:26,fingerTop:21},alarm:{color:["#ff5400","#a8ff00","#ffae00","#ff0000"],value:[]},scale:{value:[],Min:[1,5],Max:[1,9],color:"#2a2a2a",Class:"thermometer-text"},type:0,value:0};var container=document.getElementById(target);if(!container){return};if($.type(options)!=="object"){alert(Language.Chart["001"]);return};setting=$.extend(true,{},setting,options);setting.valueStatus=[setting.value[1],setting.value[2],setting.value[3]];if($.type(setting.value)=="array"){setting.value=$.type(setting.value[0])=="array"?setting.value[0][0]:setting.value[0]};$(container).css({"position":"relative"});var imgs=setting.imgs,thermometer=setting.thermometer,alarm=setting.alarm,scale=setting.scale,canvas=setting.canvas;for(var o=0,olen=alarm.value.length;o<olen;o++){if(alarm.value[alarm.value.length-1]>=scale.value[scale.value.length-1]){alarm.value.pop()}}alarm.value.push(scale.value[scale.value.length-1]);var container_w=canvas.width?canvas.width:$(container).width();var container_h=canvas.height?canvas.height:$(container).height();var cvs=document.createElement("canvas");cvs.id=target+"_canvas";cvs.className=canvas.Class;cvs.width=container_w;cvs.height=container_h;$(container).html(cvs);this.canvasForIE(cvs);var cxt=cvs.getContext("2d");cxt.canvas=null;if(setting.type==1){function countScaleHeight(value){return((value-(scale.value[0]))/(scale.value[scale.value.length-1]-scale.value[0]))*syz_h}cxt.beginPath();cxt.lineWidth=1;var x=imgs.left+21;var syz_h=89;var t=imgs.top+syz_h+14;for(var i=0,ilen=alarm.value.length;i<ilen;i++){var h=countScaleHeight(alarm.value[i])-(i>0?countScaleHeight(alarm.value[i-1]):0);h=parseInt(h)+0.5;var w=10;var y=t-countScaleHeight(alarm.value[i]);cxt.fillStyle=alarm.color[i];cxt.fillRect(x,y,w,h)}cxt.save();var syz=document.createElement("div");syz.className=target+"-szy";$(syz).css({"left":x-5,top:t-syz_h});var syz_v=document.createElement("i");var syz_vv=document.createElement("span");var syz_value=((setting.value-scale.value[0])/(scale.value[scale.value.length-1]-scale.value[0]))*89;if(setting.valueStatus[1]==0&&setting.valueStatus[2]==0){if(/IE6/g.test(Configs.Browser)){$(syz_vv).css({"height":this.Thermometer.height}).css({"height":syz_value+20-9})}else{$(syz_vv).css({"height":this.Thermometer.height}).animate({"height":syz_value+20-9},1000)}}this.Thermometer.height=syz_value+20;var em=document.createElement("em");$(syz_vv).append(syz_v);$(em).append(syz_vv);$(syz).append(em);$(container).append(syz);cxt.beginPath();cxt.lineWidth=1;cxt.strokeStyle="#a2a2a2";var scaleDiv=document.createElement("div");scaleDiv.className=target+"-scale";for(var j=0,jlen=(scale.value.length-1)*6;j<=jlen;j++){var h=Math.floor(j*(89/jlen))+39+(j>0?0.5:-0.5);cxt.moveTo(x+20,h);if(j%6==0){cxt.lineTo(x+30,h);var span=document.createElement("span");span.innerHTML=scale.value[scale.value.length-1-j/6];$(span).css({"top":h-39});$(scaleDiv).append(span)}else{cxt.lineTo(x+27,h)}}cxt.stroke();$(container).append(scaleDiv);var bg=document.createElement("div");var topbg=document.createElement("i");bg.className=target+"-bg";$(container).append(bg);$(bg).css({"left":imgs.left,"top":imgs.top});$(bg).append(topbg);return}var background=document.createElement("div");background.className=target+"-background";$(container).append(background);$(background).css({"left":imgs.left,"top":imgs.top});var finger_left=thermometer.fingerLeft+countScaleWidth(setting.value);var finger=document.createElement("div");finger.className=target+"-finger";$(container).append(finger);$(finger).css({"left":finger_left,"top":thermometer.fingerTop});cxt.save();function countScaleWidth(value){return((value-(scale.value[0]))/(scale.value[scale.value.length-1]-scale.value[0]))*thermometer.width}thermometer.left=thermometer.fingerLeft+Math.floor(setting.imgs.fingerWidth/2);for(var i=0,ilen=alarm.value.length;i<ilen;i++){var h=thermometer.height;var w=countScaleWidth(alarm.value[i])-(i>0?countScaleWidth(alarm.value[i-1]):0);var y=thermometer.top;var x=thermometer.left+(i>0?countScaleWidth(alarm.value[i-1]):0);cxt.fillStyle=alarm.color[i];cxt.fillRect(x,y,w,h)}cxt.save();var scale_y=45;var scale_x=thermometer.fingerLeft+Math.floor(setting.imgs.fingerWidth/2);var scaleText=document.createElement("div");scaleText.id=target+"_text";$(container).append(scaleText);$(scaleText).addClass(scale.Class);$(scaleText).css({"top":scale_y+scale.Max[1]});cxt.strokeStyle=scale.color;cxt.lineWidth=scale.Min[0];for(var j=0,jlen=scale.value.length;j<jlen;j++){var startX=Math.floor(scale_x+countScaleWidth(scale.value[j]))+0.5;cxt.moveTo(startX,scale_y);cxt.lineTo(startX,scale_y+6);var minw=countScaleWidth(scale.value[j+1])-(j>0?countScaleWidth(scale.value[j]):0);var startX2=Math.floor(startX+minw/2)+0.5;cxt.moveTo(startX2,scale_y);cxt.lineTo(startX2,scale_y+3);var span=document.createElement("span");span.innerHTML=scale.value[j];$(scaleText).append(span);$(span).css({"left":startX-$(span).width()/2})}cxt.stroke();cxt.save();cxt=null;cvs=null};Chart.drawMeter=function(target,options,callBack){var setting={center:[96,85],finger:{color:["#97a4b5","#EEEEEE"],angle:[180,30],width:[8,14],radius:28,speed:10},background:{radius1:27,radius2:27,color:"#f6faff"},canvas:{width:null,height:null,Class:"VAmeter-canvas"},angle:{Min:-30,Max:210},alarm:{outer:{value:[],color:["#F58800","#F6A601","#82C013","#F6A601","#F58800"],radius:50},inner:{value:[],color:["#a2ee00","#ffae00","#d8271c"],radius:31}},scale:{outer:[],inner:[]},value:{outer:[45,""],inner:[85],toFix:[1],unit:["","%"]},rotate:180,pa:false,type:0};var that=this;var container=document.getElementById(target);if(!container){return};if($.type(options)!=="object"){alert(Language.Chart["001"]);return};for(var v in options.value){if($.type(options.value[v])!="array"){options.value[v]=[options.value[v]]}}if(options.type==1){var out=options.value.outer[0];if(out>10&&out<=100){options.value.outer[0]=12}else if(out>100&&out<1000){options.value.outer[0]=16}};this.ArraySameCount=[];var optionsColorLength=options.alarm.outer.color.length;setting=$.extend(true,{},setting,options);if($.type(setting.alarm.outer.value)=="array"){setting.alarm.outer.value=Chart.AarryDeleteSame(setting.alarm.outer.value)};if($.type(setting.alarm.inner.value)=="array"){setting.alarm.inner.value=Chart.AarryDeleteSame(setting.alarm.inner.value)}setting.alarm.outer.color.length=optionsColorLength;var svo_0=setting.value.outer[0];var sao_v=setting.alarm.outer.value[0];if(svo_0<sao_v){svo_0=sao_v}if(setting.value.outer[0]>setting.alarm.outer.value[setting.alarm.outer.value.length-1]){svo_0=setting.alarm.outer.value[setting.alarm.outer.value.length-1]};$(container).css({"position":"relative"});$.extend(true,setting.scale.outer,setting.alarm.outer.value);$.extend(true,setting.scale.inner,setting.alarm.inner.value);setting.alarm.outer.value.shift();setting.alarm.inner.value.shift();var canvas=setting.canvas,background=setting.background,alarm=setting.alarm,scale=setting.scale,angle=setting.angle,finger=setting.finger,V=setting.value;for(var o=0,olen=alarm.outer.value.length;o<olen;o++){if(alarm.outer.value[alarm.outer.value.length-1]>scale.outer[scale.outer.length-1]){alarm.outer.value.pop()}}for(var o=0,olen=alarm.inner.value.length;o<olen;o++){if(alarm.inner.value[alarm.inner.value.length-1]>scale.inner[scale.inner.length-1]){alarm.inner.value.pop()}}var container_w=canvas.width?canvas.width:$(container).width();var container_h=canvas.height?canvas.height:$(container).height();var cvs=document.createElement("canvas");cvs.id=target+"_canvas";cvs.width=container_w;cvs.height=container_h;cvs.className=canvas.Class;$(container).html(cvs);this.canvasForIE(cvs);var cxt=cvs.getContext("2d");cxt.canvas=null;cxt.clearRect(0,0,1000,1000);cxt.lineWidth=1;var maxAngle=setting.angle.Max-setting.angle.Min;cxt.translate(setting.center[0],setting.center[1]);for(var s=0,slen=this.ArraySameCount.length;s<slen;s++){alarm.outer.color.splice(this.ArraySameCount[s],1)};var bigFinger=document.createElement("div");bigFinger.className=target+"-bigfinger";$(container).append(bigFinger);$(bigFinger).css({"left":setting.center[0]-$(bigFinger).outerWidth(true)/2,"top":setting.center[1]-$(bigFinger).outerHeight(true)/2});var bigfinger_canvas=document.createElement("canvas");var cvs_big=document.createElement("canvas");cvs_big.id=target+"_canvas_big";cvs_big.className=canvas.Class+"-big";cvs_big.width=container_w;cvs_big.height=container_h;$(container).append(cvs_big);this.canvasForIE(cvs_big);var cxt_big=cvs_big.getContext("2d");cxt_big.canvas=null;cxt_big.translate(setting.center[0],setting.center[1]);drawOuter();drawInnner();drawPAfinger();if(setting.type==1){var breakImg=document.createElement("div");breakImg.className=target+"-breakimg";$(container).append(breakImg)};cxt.save();var that=this;function drawOuter(){var outerList=alarm.outer.value;var outerRadius=alarm.outer.radius;cxt.rotate(that.transformAngle(setting.rotate));for(var i=0,ilen=outerList.length;i<ilen;i++){var v=((outerList[i]-scale.outer[0])/(scale.outer[scale.outer.length-1]-scale.outer[0]))*maxAngle+angle.Min;if(i>0){var v2=((outerList[i-1]-scale.outer[0])/(scale.outer[scale.outer.length-1]-scale.outer[0]))*maxAngle+angle.Min}else{var v2=angle.Min}cxt.beginPath();cxt.fillStyle=alarm.outer.color[i];cxt.moveTo(background.radius1*Math.cos(that.transformAngle(v2)),background.radius1*Math.sin(that.transformAngle(v2)));cxt.lineTo(outerRadius*Math.cos(that.transformAngle(v2)),outerRadius*Math.sin(that.transformAngle(v2)));cxt.arc(0,0,outerRadius,that.transformAngle(v2),that.transformAngle(v),false);cxt.lineTo(background.radius1*Math.cos(that.transformAngle(v)),background.radius1*Math.sin(that.transformAngle(v)));cxt.arc(0,0,background.radius1,that.transformAngle(v),that.transformAngle(v2),true);cxt.fill();cxt.beginPath();cxt.strokeStyle="#999";cxt.globalAlpha=0.4;cxt.lineWidth=1;if(i==0){cxt.arc(0,0,outerRadius-1,that.transformAngle(angle.Min),that.transformAngle(v),false)}if(i>0){cxt.arc(0,0,outerRadius-1,that.transformAngle(v2),that.transformAngle(v),false)}cxt.stroke();cxt.globalAlpha=1;v=null;v2=null}cxt.save();var outerDiv=document.createElement("div");outerDiv.className=target+"-scale";$(container).append(outerDiv);for(var z=0,zlen=scale.outer.length;z<zlen;z++){var span=document.createElement("span");if(V.toFix!=0){span.innerHTML=scale.outer[z].toFixed(V.toFix[0])+(z>0?V.unit[0]:"");if(setting.type==1&&z%5!=0){span.innerHTML=""}}else{span.innerHTML=scale.outer[z]+(z>0?V.unit[0]:"");if(setting.type==1&&z%5!=0){span.innerHTML=""}}$(outerDiv).append(span);var angle_01=((scale.outer[z]-scale.outer[0])/(scale.outer[scale.outer.length-1]-scale.outer[0]))*maxAngle;var xxx=setting.center[0]-(outerRadius+15)*Math.cos(that.transformAngle(angle_01-Math.abs(setting.angle.Min)));var yyy=setting.center[1]-(outerRadius+15)*Math.sin(that.transformAngle(angle_01-Math.abs(setting.angle.Min)));$(span).css({"position":"absolute","text-align":"center","z-inde":"9999","left":xxx-$(span).width()/2,"top":yyy-($(span).height()/2)});span=null;angle_01=null;xxx=null;yyy=null}};function drawInnner(){if(!setting.pa){cxt.save();cxt.rotate(-that.transformAngle(setting.rotate))}};function drawPAfinger(){var ov=Configs.Chart[cvs_big.id];var v=[svo_0][0];drawFinger(v);Configs.Chart[cvs_big.id]=[svo_0][0];if(setting.pa){cxt_big.rotate(-that.transformAngle(180))}var meterCenter=document.createElement("div");meterCenter.className=target+"-meterCenter";$(container).append(meterCenter);$(meterCenter).css({"left":setting.center[0]-$(meterCenter).outerWidth(true)/2,"top":setting.center[1]-$(meterCenter).outerHeight(true)/2})}function drawFinger(cv){var paValue=cv;if(setting.pa){paValue.push(V.inner[0])}var finger_tempwidth=finger.width[1],finger_tempangle=finger.angle[1];cxt_big.fillStyle=finger.color[1];var a_current=2*angle.Min-((paValue-scale.outer[0])/(scale.outer[scale.outer.length-1]-scale.outer[0]))*maxAngle;var x1=-finger_tempwidth*Math.sin(that.transformAngle(a_current-finger_tempangle/2));var y1=-finger_tempwidth*Math.cos(that.transformAngle(a_current-finger_tempangle/2));var x2=-finger_tempwidth*Math.cos(that.transformAngle(90-(a_current+finger_tempangle/2)));var y2=-finger_tempwidth*Math.sin(that.transformAngle(90-(a_current+finger_tempangle/2)));var x=alarm.outer.radius*Math.sin(that.transformAngle(a_current));var y=alarm.outer.radius*Math.cos(that.transformAngle(a_current));cxt_big.beginPath();cxt_big.moveTo(x1,y1);cxt_big.lineTo(x,y);cxt_big.lineTo(x2,y2);cxt_big.fill();cxt_big.save()}options=null};Chart.drawHybridCurrentTime=null;Chart.drawHybrid=function(target,options){var setting={canvas:{width:510,height:300,Class:"hybrid-canvas"},scale:{X:["04-01","04-02","04-03","04-04","04-05","04-06","04-07","04-08"],Y:["0.0","20.0","40.0","60.0","80.0","100.0"]},unit:"A",period:7,week:1,value:{AC:[],Solar:[],DG:[],Wind:[]},color:{"AC":"#ED1C23","Solar":"#EDB91C","DG":"#000","Wind":"#008CC7"}};var that=this;var container=document.getElementById(target);if(!container){return};if($.type(options)!=="object"){alert(Language.Chart["001"]);return};for(var item in setting.value){setting.value[item]=[]};setting=$.extend(true,{},setting,options);$(container).css({"position":"relative"});var canvas=setting.canvas;var scale=setting.scale;var V=setting.value;var isHaveCanvas=document.getElementById(target+"_canvas");if(isHaveCanvas){var cvs=isHaveCanvas}else{var cvs=document.createElement("canvas");cvs.id=target+"_canvas";cvs.className=canvas.Class;cvs.width=canvas.width;cvs.height=canvas.height;$(container).append(cvs)}this.canvasForIE(cvs);var cxt=cvs.getContext("2d");cxt.canvas=null;cxt.clearRect(0,0,1000,1000);if(setting.period<scale.X.length){scale.X.splice(0,scale.X.length-setting.period)}var maxLength=0,maxItem=null;for(var p in V){if(V[p].length>maxLength){maxLength=V[p].length;maxItem=p}}if(maxItem){var currentTime=V[maxItem][maxLength-1][0].split(" ")[0]}else{currentTime=this.drawHybridCurrentTime}var cTime=new Date(new Date(currentTime).setDate(new Date(currentTime).getDate()-setting.period*(setting.week-1)));currentTime=cTime.getFullYear()+"/"+this.makeupZero(cTime.getMonth()+1)+"/"+this.makeupZero(cTime.getDate());function getWeekDatas(n){for(var p in V){if(!V[p]||V[p].length==0){continue}if(V[p].length>0){var currentDate=new Date(currentTime),currentDateIndex=null,prevSeven=new Date(new Date(currentTime).setDate(new Date(currentTime).getDate()-setting.period)),prevSevenIndex=null;for(var i=0,ilen=V[p].length;i<ilen;i++){var tempTime1=V[p][i][0].split(" ")[0],tempDate1=new Date(tempTime1).getTime();if((currentDate-tempDate1)>=0){currentDateIndex=i}if((prevSeven-tempDate1)>=0){prevSevenIndex=i+1}}if(currentDateIndex!=null){V[p].splice(currentDateIndex+1,ilen-(currentDateIndex+1));if(prevSevenIndex!=null){V[p].splice(0,prevSevenIndex)}}else{V[p].splice(0,ilen)}}}}var lastDate=new Date(currentTime);lastDate.setDate(lastDate.getDate()+1);for(var j=setting.period;j>=0;j--){if(j==setting.period){setting.scale.X[j]=new Date(lastDate.setDate(lastDate.getDate()))}else{setting.scale.X[j]=new Date(lastDate.setDate(lastDate.getDate()-1))}setting.scale.X[j].setHours(0);setting.scale.X[j].setMinutes(0);setting.scale.X[j].setSeconds(0);setting.scale.X[j].setMilliseconds(0)}cxt.lineWidth=1;var lineColor=["#afafaf","#898989"];var Hybrid=$("#hybrid");if(isHaveCanvas){var xdiv=Hybrid.find("div."+target+"-x")}else{var xdiv=document.createElement("div");xdiv.className=target+"-x";$(container).append(xdiv)}for(var i=0,ilen=(scale.X.length-1)*12;i<=ilen;i++){var x=canvas.width/ilen;var x1=Math.floor(x*i)+0.5;cxt.beginPath();if(i%12==0||i==ilen){cxt.strokeStyle=lineColor[0];var spanHTML=this.makeupZero(scale.X[i/12].getMonth()+1)+"-"+this.makeupZero(scale.X[i/12].getDate());if(i==ilen){this.drawHybridCurrentTime=scale.X[i/12].getFullYear()+"/"+this.makeupZero(scale.X[i/12].getMonth()+1)+"/"+this.makeupZero(scale.X[i/12].getDate()-1)}if(isHaveCanvas){var span=xdiv.find("span")[i/12];span.innerHTML=spanHTML}else{var span=document.createElement("span");span.innerHTML=spanHTML;$(xdiv).append(span)}$(span).css({"left":x1-$(span).width()/2})}else{cxt.strokeStyle=lineColor[1]}cxt.moveTo(x1,0);cxt.lineTo(x1,canvas.height);cxt.stroke()}if(no_data_status){$(xdiv).hide()}else{$(xdiv).show()}cxt.beginPath();cxt.strokeStyle=lineColor[0];cxt.moveTo(canvas.width-0.5,0);cxt.lineTo(canvas.width-0.5,canvas.height);cxt.stroke();cxt.save();if(isHaveCanvas){var ydiv=Hybrid.find("div."+target+"-y")}else{var ydiv=document.createElement("div");ydiv.className=target+"-y";$(container).append(ydiv)}for(var i=0,ilen=(scale.Y.length-1)*10;i<=ilen;i++){var y=canvas.height/ilen;var y1=Math.floor(y*i)+0.5;cxt.beginPath();if(i%10==0||i==ilen){cxt.strokeStyle=lineColor[0];if(isHaveCanvas){var span=ydiv.find("span")[i/10];span.innerHTML=scale.Y[i/10]+setting.unit}else{var span=document.createElement("span");span.innerHTML=scale.Y[i/10]+setting.unit;$(ydiv).append(span);$(span).css({"top":canvas.height-y1-(i==0?$(span).height():$(span).height()/2)})}}else{cxt.strokeStyle=lineColor[1]}cxt.moveTo(0.5,y1);cxt.lineTo(canvas.width-1,y1);cxt.stroke()}cxt.beginPath();cxt.strokeStyle=lineColor[0];cxt.moveTo(0,canvas.height-0.5);cxt.lineTo(canvas.width,canvas.height-0.5);cxt.stroke();cxt.save();var allCount=setting.period*24*60*60*1000;var firstCount=scale.X[0].getTime();cxt.lineWidth=1.5;var maxValue=Number(scale.Y[scale.Y.length-1]);var valueOut=false;var no_data_status=true;var StartTime=scale.X[0].getTime();var EndTime=scale.X[scale.X.length-1].getTime();for(var line in V){if(!V[line]){continue}cxt.strokeStyle=setting.color[line];cxt.fillStyle=setting.color[line];cxt.beginPath();for(var z=0,zlen=V[line].length;z<zlen;z++){var CurrentTime=new Date(V[line][z][0]).getTime();var x=Math.floor(((CurrentTime-firstCount)/allCount)*canvas.width)+0.5;var y=Math.floor(canvas.height-(V[line][z][1]/100)*canvas.height)+0.5;if(y>=canvas.height){y=canvas.height-1}if(y<=0.5){y=1}if(CurrentTime>=StartTime&&CurrentTime<=EndTime){no_data_status=false};if(!valueOut){if(CurrentTime>=StartTime&&CurrentTime<=EndTime){if(V[line][z][1]>maxValue){valueOut=true}}};if(zlen==1){cxt.beginPath();if(y+1.5>=canvas.height){y=canvas.height-2}if(y<=2){y=2}cxt.arc(x,y,1,0,Math.PI*2,true);cxt.fill();cxt.save();cxt.closePath()}else{if(z==0){cxt.moveTo(x,y)}else{cxt.lineTo(x,y)}}}cxt.stroke()}cxt.save();var HybridTip=$(container).find("div.hybrid-tip");if(valueOut){if(HybridTip[0]){HybridTip.show()}else{var HybridTip=document.createElement("div");HybridTip.className="hybrid-tip";HybridTip.innerHTML=Language.Chart["002"];$(container).append(HybridTip)}}else{HybridTip.hide()};var hybirdNoData=$("div.hybird-nodata");if(no_data_status){hybirdNoData.show()}else{hybirdNoData.hide()};var hybridHandle=$("#hybridHandle");if(hybridHandle.css("visibility")=="hidden"){hybridHandle.css({"visibility":"visible"})}};Chart.drawColumn=function(target,options){var setting={canvas:{width:480,height:210,Class:"cabinet-map-canvas"},scale:{X:[],Y:[]},unit:"A",color:["#00c158","#ffc800","#ff0000"],value:null,maxLength:25};var that=this;var container=document.getElementById(target);if(!container){return};if($.type(options)!=="object"){alert(Language.Chart["001"]);return};setting=$.extend(true,{},setting,options);$(container).css({"position":"relative"});var canvas=setting.canvas;var scale=setting.scale;var V=setting.value;var isHaveCanvas=document.getElementById(target+"_canvas");if(isHaveCanvas){var cvs=isHaveCanvas}else{var cvs=document.createElement("canvas");cvs.id=target+"_canvas";cvs.className=canvas.Class;cvs.width=canvas.width;cvs.height=canvas.height;$(container).append(cvs)}this.canvasForIE(cvs);var cxt=cvs.getContext("2d");cxt.canvas=null;var ilen=V.length<=setting.maxLength?V.length:setting.maxLength;var item=Math.floor((canvas.width-4.5)/ilen);var canvasWidth=item*ilen;cxt.strokeStyle="#aaa";cxt.lineWidth=1;cxt.beginPath();cxt.moveTo(4.5,canvas.height-4.5);cxt.lineTo(canvasWidth+4.5,canvas.height-4.5);cxt.stroke();var DFrag=document.createDocumentFragment();var DFrag2=document.createDocumentFragment();var DFrag3=document.createDocumentFragment();var yMax=-Infinity,yMin=Infinity;for(var j=0;j<ilen;j++){yMax=Math.max(yMax,parseFloat(V[j][3]));yMin=Math.min(yMin,parseFloat(V[j][3]))}yMax=yMax+(yMax%10==0?0:(10-yMax%10));yMin=yMin-(yMin%10==0?0:(10-yMin%10));if(yMax==0){yMax=10};var vnum=10;var vitem=Math.floor((canvas.height-4.5)/vnum);cxt.lineWidth=1;cxt.beginPath();cxt.moveTo(4.5,canvas.height-vitem*10-6.5);cxt.lineTo(4.5,canvas.height-4.5);cxt.stroke();for(var y=0;y<=vnum;y++){cxt.beginPath();cxt.strokeStyle="#aaa";var yv=canvas.height-y*vitem-6.5;cxt.moveTo(0,yv);cxt.lineTo(4.5,yv);cxt.stroke();var span=document.createElement("span");span.innerHTML=yMax/vnum*y;span.style.top=yv+"px";DFrag3.appendChild(span);if(y==0){continue}cxt.beginPath();cxt.strokeStyle="#e5e5e5";var yv=canvas.height-y*vitem-6.5;cxt.moveTo(5.0,yv);cxt.lineTo(canvasWidth,yv);cxt.stroke()}cxt.strokeStyle="#aaa";var vDiv=document.createElement("div");vDiv.className=target+"-v";$(vDiv).css({"height":canvas.height+20});vDiv.appendChild(DFrag3);container.appendChild(vDiv);var isIE678=/IE6|IE7|IE8/g.test(Configs.Browser);var xSpan=[];for(var i=0;i<=ilen;i++){cxt.beginPath();cxt.moveTo(item*i+4.5,canvas.height-4.5);cxt.lineTo(item*i+4.5,canvas.height);cxt.stroke();if(i<ilen){var left=item*i+4.5+item/2-6.5;var span=document.createElement("span");span.title=V[i][2];span.innerHTML=V[i][2];span.style.left=left+"px";DFrag.appendChild(span);xSpan.push(span);var span=document.createElement("span");$(span).css({left:left-item/4+6.5,height:parseFloat(V[i][3])/yMax==0?1:100*parseFloat(V[i][3])/yMax+"%",width:item/2,background:setting.color[V[i][4]-1]});span.innerHTML=V[i][2]+" : "+V[i][3];DFrag2.appendChild(span)}}var XDiv=document.createElement("div");XDiv.className=target+"-X";XDiv.style.width=canvas.width+"px";XDiv.appendChild(DFrag);container.appendChild(XDiv);var xSpanMax=-Infinity;for(var i=0,ilen=xSpan.length;i<ilen;i++){var xSpanHeight=isIE678?Number($(xSpan[i]).height()):Number($(xSpan[i]).width());xSpanMax=Math.max(xSpanMax,xSpanHeight)}xSpanMax=xSpanMax>200?200:xSpanMax<35?35:xSpanMax;var PromptPop=document.getElementById(setting.popup);if(PromptPop){var PromptPopHeight=setting.popupHeight+xSpanMax;$(PromptPop).css({"height":PromptPopHeight-100,"margin-top":-(PromptPopHeight-100)/2})}$(xSpan).css({"width":xSpanMax+"px","height":xSpanMax+"px"});var YDiv=document.createElement("div");YDiv.className=target+"-Y";YDiv.style.width=canvasWidth+"px";YDiv.style.height=canvas.height-9+"px";YDiv.appendChild(DFrag2);container.appendChild(YDiv);var tip=document.createElement("div");tip.className=target+"-tip";YDiv.appendChild(tip);var timer=null;var YRPosition=$(YDiv).position().left+canvasWidth;$(YDiv).find("span").off().on("mousemove",function(){clearTimeout(timer);var $this=$(this);$(tip).html($this.text());var thisLeft=$this.position().left;var thisWidth=$this.width()/2;var left=thisLeft+thisWidth;var bottom=$this.css("height");var tipWidth=$(tip).innerWidth();if(tipWidth+left>YRPosition){left=thisLeft-tipWidth;$(tip).addClass("Pop_CabinetMap-tip-r")}else{$(tip).removeClass("Pop_CabinetMap-tip-r")}$(tip).fadeIn().css({left:left,bottom:bottom})}).on("mouseleave",function(){timer=setTimeout(function(){$(tip).fadeOut()},1000)})};
/*!
 * Author: Jerman.Xie | xieguishi@126.com
 * Date: 2013.09
 *
 * 数据文件:
 * 储存初始化的配件数据
 * 储存缓存数据或实际数据
 * 储存任何需要在web中应用到的数据
 */
;var Configs={login:"login.html",HomePage:true,isHomePage:function(t){return/HomePage/g.test(t)},MainScrollHeight:0,Modules:{Defaults:["header","sider","mainBar","mainContent"],Renders:["header","sider","mainBar","mainContent","alarm"]},Navigation:{current:"currentMenu",space:"<span></span>",nav:[],currentObj:null,prevObj:null,parentObj:null,index:0},Template:{info:{data:"/var/datas/data.index.html",template:"tmp.index.html"},prefix:"tmp_",content:{},common:[]},Data:{content:{},cache:"",complete:false,failMax:6,failNum:0,fail:false,endStr:"\"%__data_end__%\"",intervalUp:2000,intervalCache:5000,interval:5000,defaultInterval:5000,timeout:5000,defaultTimeout:5000,polling:true,setting:{},render:true},Alarm:{url:"/var/datas/data.alarms.html",cache:"",cacheLength:0,data:{},interval:5000,show:false,auto:1,tab:"",scrollHeight:0,expand:false,failMax:6,failNum:0,requestCount:0,refresh:60,timeout:10000},Hybrid:{data:{},lines:{},week:1},Trend:{url:"/var/datas/data.index_trend.html",dataCache:"",data_y:{},data:{},tempInterval:2000,interval:3600000,failNum:0,failMax:6,fail_200:false,Enter:false,Point:0},TrendCvWidth:600,ChartdrawCurve_Y:[17,19,28,28],Cookies:{names:[],path:"/"},protocol_type:null,Commons:{solar:null,converter:null},Popup:{index:null,status:false,scrollHeight:0},Sider:{Controller:[]},Backspace:false,KeepActive:true,TimeFormat:0,timezone:0,SystemTime:"",Browser:"",ClickHomeNum:0,ClickHomeMax:10,RestartTime:200,Chart:{},ClickInterval:350,TabIndex:0,PowerSystem:[],HighLight:null,StopReload:false,UploadTimeout:null,SelectFocus:null,tmpTimer:[],refresh:false,bodyScroll:0,refreshalarm:true,autoclick:false};
/*!
 * Author: Jerman.Xie | xieguishi@126.com
 * Date: 2013.09
 *
 * 控制器：
 * 控制是否向服务器发送异步请求,并获取数据
 * 控制渲染数据到页面
 * 控制错误提示
 */
;var Control={isPolling:false,isAlarmPolling:false,isTrendPolling:false,polling:null,dataEtag:null,templateEtag:null,alarmEtag:null,trendEtag:null,CheckLogin:function(){var name=jQuery.cookie("user_name");if(!name||name==""||name=="null"){alert(Language.Html['019']);location.href=Configs.login;return false}return true},CheckReLogin:function(){if(jQuery.cookie("restart")=="1"){location.href=Configs.login;return false}return true},RefreshModule:function(re){if(re===false){return false}else{if($.type(re)=="array"&&re[0]==true&&$.type(re[1])=="function"){re[1]();return false}};this.CheckReLogin();if(Configs.Data.failNum!=0){Configs.Data.failNum=0}var PromptCover=document.getElementById("PromptCover");if(PromptCover&&!document.getElementById("SetProgress")){$(PromptCover).remove()}this.GetTemplate(Configs.Template.info,true)},LoginOut:function(url){var clearCookies=Configs.Cookies.names;for(var i=0,ilen=clearCookies.length;i<ilen;i++){jQuery.removeCookie(clearCookies[i],"")}if(url){location.href=url}else{location.href=Configs.login}},PromptEvent:{GetElement:function(target){var type=$.type(target);switch(type){case"string":return $("#"+target.replace("#",""));case"object":return $(target);default:return false}},CheckObj:function(args){if(!$.type(args)=="object"){return false}return true},ResetStatus:null,ResetEle:function(parent,child,args){if(args["reset"]){parent=$("#"+parent)}var interval=args["interval"];if($.type(interval)=="number"&&interval>=0){setTimeout(function(){SetPosition()},args["interval"])}else{SetPosition()}this.ResetStatus=args["marginTop"];function SetPosition(){if(!child){return false}var $child=$(child);var child_width=$child.innerWidth();var target_width;if(jQuery.cookie("systeminfo")==0){target_width=1163}else{target_width=917}var offset=parent.offset();if(!offset){return}var top=offset.top;var marginTop=args["marginTop"];var left=(target_width-child_width)/2;if(marginTop=="center"){top=(parent.height()-$child.height())/2}else{if($.type(marginTop)=="number"){top=marginTop-35}else{var ph=parent.height();var ch=$child.height();if(ph>70*2){top=70}else if(ph>ch+10&&ph<70*2){top=(ph-ch)/2}else{top=0}}}$child.css({"left":left,"top":top}).show()}},Remove:function(args){this.LoadingRemove(args);this.TipRemove(args)},LoadingData:{},LoadingStatus:false,LoadingRemove:function(args){var id_prefix="#PromptLoading_";var remove=args["remove"];if(remove&&$.type(remove)=="string"){var target=$(id_prefix+remove);if(target){target.remove();delete this.LoadingData[remove];this.LoadingStatus="removed"}}},Loading:function(args){this.LoadingStatus="created";var loadingClass="PromptLoading2";var id_prefix="PromptLoading_";if(!this.CheckObj(args)){return};if(document.getElementById(id_prefix+args["target"])){return};if(args["reset"]==true){var loadingdata=this.LoadingData;if(loadingdata){for(var item in loadingdata){this.ResetEle(loadingdata[item]["target"],loadingdata[item]["loading"],args)}};return};this.LoadingRemove({remove:args["remove"],id_prefix:id_prefix});if(this.LoadingStatus=="removed"){return false}var target=this.GetElement(args["target"]);if(!target[0]){return false}var target_id=target[0].id;var clear=(args["clear"]===false)?args["clear"]:true;if(clear){target[0].innerHTML=""}var loading=document.createElement("div");$(loading).attr("id",id_prefix+target_id);target[0].appendChild(loading);this.LoadingData[target_id]={target:target_id,loading:loading};var Class=args["Class"];if(Class&&$.type(Class)=="string"){loadingClass+=" "+Class};loading.className=loadingClass;var html=args["html"];loading.innerHTML="<img src='../images/update_loading.gif'>"+(html?html:Language.Html["013"]);this.ResetEle(target,loading,args)},TipRemove:function(args){var target=$("#PromptTip_"+args["remove"]);if(target[0]){target.remove()}},Tip:function(args){if(!this.CheckObj(args)){return};var target=this.GetElement(args["target"]);if(!target[0]){return false}var target_id=target[0].id;this.LoadingRemove({remove:target_id});var TipClass="PromptTip";var Class=args["Class"];if(Class&&$.type(Class)=="string"){TipClass+=" "+Class};var Tip=document.getElementById("PromptTip_"+target_id);if(Tip){$(Tip).remove()}Tip=document.createElement("div");$(Tip).attr("id","PromptTip_"+target_id);Tip.className=TipClass;var TipContent=document.createElement("div");TipContent.className="PromptTipContent";var clear=args["clear"]===true?args["clear"]:false;if(clear){target[0].innerHTML=""}var text=args["text"];var ErrorImgURL=(args["img"]&&args["img"]!="")?args["img"]:'../images/error.gif';TipContent.innerHTML=(text&&text!=""?text:Language.Html["038"]);Tip.appendChild(TipContent);Tip.style.visibility="hidden";target[0].appendChild(Tip);this.ResetEle(target,Tip,args);Tip.style.visibility="visible"},Alert:function(text){if(!text){return false};var html="<div class='PromptAlertContent'><img src='../images/error.gif'>"+text+"</div><div class='PromptAlertButton'><a href='#'>"+Language.Html["015"]+"</a></div>";this.Pop({title:Language.Html["039"],Class:"PromptAlert",fn:t,html:html});var that=this;function t(data,pop,cover){var width=$(pop).find("div.PromptAlertContent").innerWidth()+40;$(pop).css({"width":width,"margin-left":"-"+width/2+"px"});var button=$(pop).find("div.PromptAlertButton>a");button.focus();button.one("click",function(){that.PopClose(pop,cover);return false});$(pop).css("visibility","visible")}return false},Cover:function(args){var getCover=document.getElementById("PromptCover");var HasCover=(args&&args["target"])?args["target"]:getCover;if(HasCover||getCover){SetCover(HasCover);$(HasCover).show();return getCover}var opacity=0.3;var backgroundColor="#000";if(args&&this.CheckObj(args)){if(args&&args["opacity"]){opacity=args["opacity"]};if(args["backgroundColor"]){backgroundColor=args["backgroundColor"]}};var cover=document.createElement("div");cover.id="PromptCover";cover.className="PromptCover";SetCover(cover);function SetCover(target){if(!$(target)[0]){target=document.getElementById("PromptCover")};var body=$("body");var width=body.innerWidth();var height=body.innerHeight();if(/IE6/g.test(Configs.Browser)){target.innerHTML="<iframe width='"+width+"px' height='"+height+"px' frameborder='0' scrolling='no' marginheight='0' marginwidth='0' src='about:blank'></iframe>"}$(target).css({"width":width,"height":height,opacity:opacity,"background-color":backgroundColor})}$("body").append(cover);return cover},Pop:function(args){if(!this.CheckObj(args)){return};function callFun(){if($.type(args["fn"])=="function"){if(args["Class"]=="PromptAlert"){$(pop).css("visibility","hidden")};args["fn"](args["data"],pop,cover)}}if(document.getElementById("PromptPop")){callFun();return false}var body=$("body");var ScrollTop=$(window).scrollTop();args["cover"]=(args["cover"]===false)?args["cover"]:true;var cover=this.Cover(args);var oFrag=document.createDocumentFragment();var pop=document.createElement("div");pop.id="PromptPop";var popClass="PromptPop";var Class=args["Class"];if(Class&&$.type(Class)=="string"){popClass+=" "+Class};pop.className=popClass;var pop_title=document.createElement("div");pop_title.id="PromptPopTitle";pop_title.className="PromptPopTitle";var titleHTML="";if(args["title"]&&args["title"]!=""){titleHTML+=args["title"]}pop_title.innerHTML="<span>"+titleHTML+"</span><a href='#' id='PromptPopClose' class='PromptPopClose'></a>";oFrag.appendChild(pop_title);var pop_content=document.createElement("div");pop_content.id="PromptPopContent";pop_content.className="PromptPopContent";if(args["html"]){pop_content.innerHTML=args["html"]}oFrag.appendChild(pop_content);pop.appendChild(oFrag);body.append(pop);$(pop).show();callFun();var that=this;$("#PromptPopClose").one("click",function(){that.PopClose(pop,cover);return false})},PopClose:function(pop,cover){Control.RemoveFrames();$(pop).remove();$(cover).remove()}},ReGetData:null,ClickStart:0,GetTemplate:function(args,refresh){this.CheckReLogin();Configs.refresh=false;var SetProgress=document.getElementById("SetProgress");Configs.Popup.status=false;if(SetProgress&&!refresh){return false}if((this.ClickStart!=0||SetProgress)&&args["clickfast"]!==false){if(new Date().getTime()-this.ClickStart<Configs.ClickInterval){if(SetProgress){$(SetProgress).remove()}Pages.SetProcess(Language.Html["033"],null,"ClickTooFast");Pages.SetProcessOK(Language.Html["033"],500);this.ClickStart=new Date().getTime();return false}}this.ClickStart=new Date().getTime();if(this.ReGetData){clearTimeout(this.ReGetData)};this.ReGetData=setTimeout(function(){var content=$("#mainContent");if(content[0]){if(content.find("div.PromptLoading2").length>0){that.RefreshModule()}}},20000);Configs.Data.timeout=(args.timeout&&$.type(args.timeout)=="number")?args.timeout:Configs.Data.defaultTimeout;if(Configs.isHomePage(args["fn"])){Control.StopPollingTrend()}else{if(!Control.isPolling){if(Configs.ClickHomeNum>Configs.ClickHomeMax){window.location.reload();return false}}}var that=this;if(!this.CheckLogin()){return false}if(Configs.Alarm.expand){Control.SetLayout();Configs.Alarm.expand=false}this.StopPolling();if(!args["template"]){alert(Language.Html['003']);return}if(that.SettingOtherXHR||that.SettingOtherXHR!=null){that.SettingOtherXHR.abort()};if(that.DataXHR||that.DataXHR!=null){that.DataXHR.abort();Configs.Data.failNum=0}if(that.TemplateXHR||that.TemplateXHR!=null){that.TemplateXHR.abort()}Control.SetNavigation(args);var menuIndex=Number(args['menuIndex']);var getTemplates=[];if(/,/g.test(args["template"])){getTemplates=args["template"].split(",")};var getTemplatesLength=getTemplates.length;var getUrlTimes=0;function loopGet(time){if(getTemplatesLength>0){if(time<getTemplatesLength){var requireURL=getTemplates[time];if(/:/g.test(requireURL)){var requireSigns=requireURL.split(":");get(requireSigns[1],requireSigns[0])}else{get(requireURL)}}}else{get(args["template"])}}loopGet(0);function get(url,templateSign){that.TemplateXHR=$.ajax({timeout:Configs.Data.timeout,dataType:"html",cache:true,url:url,beforeSend:function(){var currentModules=document.getElementById(args["modules"]);if(currentModules){$(currentModules).children().off().html("");that.PromptEvent.Loading({target:currentModules})}if(args){if($.type(args['modules'])=='string'){Configs.Modules.Renders=[];if(/,/g.test(args['modules'])){Configs.Modules.Renders=$.extend(true,{},Configs.Modules.Renders,args['modules'].split(','))}else{Configs.Modules.Renders.push(args['modules'])}}else{Configs.Modules.Renders=$.extend(true,{},Configs.Modules.Renders,args['modules'])}}},success:function(data,textStatus,jqXHR){if(Configs.isHomePage(args["fn"])){Configs.HomePage=true}else{Configs.HomePage=false}that.isPolling=false;if(jqXHR.status==200){if(getUrlTimes<getTemplatesLength-1){if(templateSign){Configs.Template.common.push([templateSign,data])}else{Configs.Template.common.push(data)}getUrlTimes++;loopGet(getUrlTimes);return}else{that.templateEtag=jqXHR.getResponseHeader("Etag");if(data){var modules=Configs.Modules.Renders;if(modules.length==1){var commonHTML=Configs.Template.common;for(t=0,tlen=commonHTML.length;t<tlen;t++){if(commonHTML[t]instanceof Array){var tmpReg=new RegExp(commonHTML[t][0],"g");if(tmpReg.test(data)){data=data.replace(tmpReg,commonHTML[t][1])}else{data=commonHTML[t][1]+data}}else{data=commonHTML[t]+data}};Configs.Template.content[modules[0]]=data;Configs.Template.common=[];gettime=0}else{}}else{var innerTemplate=document.getElementById(args["template"]);Configs.Template.content['mainContent']=innerTemplate?innerTemplate.innerHTML:""}}}Configs.Template.info=args;Configs.MainScrollHeight=0;if(!args['data']){that.RenderData();return}if(menuIndex==0||menuIndex==1||(menuIndex==2&&args['data'])){if(args['data']){that.GetData()}else{that.RenderData()}}else if(menuIndex==2&&!args['data']){if(jqXHR.status==200){Configs.Template.content[args['name']]=data}that.RenderData()}},error:function(data,textStatus){if(textStatus=="abort"){that.TemplateXHR=null;return false}switch(data.status){case 404:if(Configs.isHomePage(args["fn"])){setTimeout(function(){location.reload()},3000)}else{that.PromptEvent.Tip({target:args["modules"],text:Language.Html['003']+Configs.Prompt.refresh})}break};that.StartPolling()}}).always(function(jqXHR,textStatus,errorThrown){jqXHR=null;textStatus=null;errorThrown=null;that.TemplateXHR=null})}},StartPolling:function(args){var that=this;if(that.DataXHR||that.DataXHR!=null){that.DataXHR.abort();that.DataXHR=null};if(!Configs.Data.polling){this.StopPolling();return};if(!this.CheckLogin()){return false}if(!Configs.Data.complete){if(args){Configs.Data.interval=args['interval']||2500}}else{if(Configs.Data.interval==Configs.Data.intervalUp){Configs.Data.interval=Configs.Data.intervalCache}}this.polling=setTimeout(function(){that.isPolling=true;that.GetData();that.polling=null},Configs.Data.interval)},StopPolling:function(){if(this.polling){clearTimeout(this.polling);this.polling=null}if(this.DataXHR||this.DataXHR!=null){this.DataXHR.abort();this.DataXHR=null}},GetData:function(argsInfo){if(!Configs.Data.render){this.StartPolling();return}var that=this;var args=argsInfo?argsInfo:Configs.Template.info;if(this.DataXHR||this.DataXHR!=null){this.DataXHR.abort();this.DataXHR=null};Configs.Data.polling=args.polling===false?false:true;if(Configs.Data.polling){if(args.polling&&$.type(args.polling)=="number"){Configs.Data.intervalCache=args.polling;Configs.Data.interval=args.polling}else{Configs.Data.intervalCache=Configs.Data.defaultInterval;Configs.Data.interval=Configs.Data.intervalCache}}var urls=Configs.Template.info["data"].split(",");var getTimes=0;var datas={};var cache="";var cacheData="";get();function get(url){url=url?url:urls[0];var key=null;if(/:/g.test(url)){var urlarr=url.split(":");url=urlarr[1];key=urlarr[0]}that.DataXHR=$.ajax({dataType:"html",headers:{"If-None-Match":that.isPolling?that.dataEtag:""},url:url+"?_="+new Date().getTime(),data:args['parameter']?args['parameter']:"",timeout:Configs.Data.timeout,beforeSend:function(){if(that.isPolling){that.StopPolling()}if(that.SyncTimer){clearTimeout(that.SyncTimer)}if(Configs.Template.info.sync){var CurrentModule=$(document.getElementById(args["modules"]));var LoadingOrTip=CurrentModule.find("div.PromptLoading2").length!=0||CurrentModule.find("div.PromptTip").length!=0;if(LoadingOrTip){that.SyncTimer=setTimeout(function(){that.StartPolling()},5000)}}},success:function(data,textStatus,jqXHR){if(jqXHR.status==200){that.dataEtag=jqXHR.getResponseHeader("Etag");if(!Configs.Template.info.sync){var re=new RegExp(Configs.Data.endStr,'g');if(re.test(data)){Configs.Data.complete=true;data=data.replace(Configs.Data.endStr,"")}else{Configs.Data.cache=data;if(!that.isPolling){Configs.Data.complete=false;that.PromptEvent.Tip({target:args["modules"],text:Language.Html['005']+Configs.Prompt.refresh})}that.StartPolling({"interval":Configs.Data.intervalUp});return}}cacheData+=data;if(that.isPolling&&!Configs.Template.info.sync&&(getTimes==urls.length-1)){if(Configs.Data.cache==cacheData){that.StartPolling();return}};cache+=data;if(getTimes==urls.length-1){Configs.Data.cache=cache}try{data=jQuery.evalJSON(data);if(key!=null){var idata={};idata[key]=data;data=idata}if(data.footer){jQuery.cookie("Verizon_Mode",data.footer.Verizon_Mode[0],{path:"/"})}datas=$.extend(true,{},datas,data);if(getTimes==urls.length-1){data=datas}else{getTimes++;get(urls[getTimes]);return}}catch(e){if(!that.isPolling){that.PromptEvent.Tip({target:args["modules"],text:Language.Html['001']})}that.StartPolling();return}}else if(jqXHR.status==304){if(Configs.Data.complete){that.StartPolling()}else{that.StartPolling({"interval":Configs.Data.intervalUp})}return}if(Configs.HomePage){if(that.isPolling){Configs.Modules.Renders=[];for(var Item in data){if(jQuery.toJSON(data[Item])!=jQuery.toJSON(Configs.Data.content[Item]||"")){Configs.Modules.Renders.push(Item)}}}else{Configs.Modules.Renders=Configs.Modules.Defaults}}if(Configs.HomePage){Configs.Data.content=data}else{var newData={};for(var n=0,nlen=Configs.Modules.Renders.length;n<nlen;n++){var rm=Configs.Modules.Renders[n];if(args["name"]&&args["name"]!=""){if(rm=="mainBody"){rm="mainContent"}}newData[rm]=data;if(data[rm]){newData[rm]=data[rm]}}Configs.Data.content=newData};Configs.Data.failNum=0;if(that.SyncTimer){clearTimeout(that.SyncTimer)}if(data.status==98){that.PromptEvent.Tip({target:args["modules"],text:Language.Html['019']});that.StopPolling();return};that.RenderData()},error:function(jqXHR,textStatus,errorThrown){that.dataEtag="";Configs.Data.cache="";if(textStatus!="abort"){that.DealError(textStatus,args,Configs.Data)}}}).always(function(jqXHR,textStatus,errorThrown){jqXHR=null;textStatus=null;errorThrown=null;that.DataXHR=null})}},DealError:function(textStatus,args,data){var that=this;var args=args?args:Configs.Template.info;var alarm=data==Configs.Alarm?true:false;function Repolling(){if(alarm){that.StartPollingAlarm()}else{that.StartPolling()}}if(Configs.wrapper.is(":hidden")){Repolling();return false};function ShowTip(target,text){var TipInfo={target:target?target:args["modules"],text:text?text:Language.Html['036']};if(alarm){TipInfo.Class="alarm-prompt"}that.PromptEvent.Tip(TipInfo)}if(alarm){if(Configs.Data.polling&&Configs.Data.fail==false){data.failNum++;if(data.failNum>=data.failMax){if(document.getElementById("PromptLoading_alarm")){ShowTip("alarm",Language.Html["002"])}else if($("#SetProgress")[0]){Pages.SetProcessDone(Language.Html["002"])}data.failNum=0;data.cache="";that.alarmEtag=""}that.StartPollingAlarm();return false}args["modules"]="alarm"}data.failNum++;if(data.failNum>=data.failMax){that.dataEtag="";if(alarm){that.alarmEtag=""}data.cache="";data.failNum=0;data.fail=true;var PromptLoading=$("div.PromptLoading2");function showError(text){that.StopKeepLogin();that.StopPollingTrend();that.StopPolling();if(alarm){that.StopPollingAlarm();if(Configs.Data.fail){ShowTip();return false}}else{if(Configs.Data.fail){that.StopPollingAlarm()}}if(confirm(Language.Html["036"]+"\n\n"+Language.Html["036_1"])){Control.LoginOut()}else{if(/IE/g.test(Configs.Browser)){window.opener=null;window.open('','_self');window.close();return};if(PromptLoading.length>0){ShowTip()}else if($("#SetProgress")[0]){Pages.SetProcessDone(Language.Html["036"])}jQuery.cookie("restart","1",{path:"/"});return false}return false}switch(textStatus){case"parsererror":case"success":showError(Language.Html['001']);break;case"error":default:showError(Language.Html['002']);break}}else{if(Configs.Template.info.sync&&args["modules"]!="alarm"){clearTimeout(that.SyncTimer);Configs.Data.polling=false;that.PromptEvent.Tip({target:args["modules"],text:Language.Html['002']})}Repolling()}},RenderData:function(){if(!Configs.Data.render){return}var that=this;var args=$.extend(true,{},args,Configs.Template.info);var requireArrs=[];var requireArrsOne="";if($.type(args["fn"])!="undefined"&&$.trim(args["fn"])!=""){if(args["fn"]===false){requireArrsOne=args["fn"]}else{requireArrs=(args["fn"]instanceof Array)?args["fn"]:args["fn"].split(",");requireArrsOne=requireArrs[0]}}if(args["template"]&&$.trim(args["template"])!=""){var str_template=args["template"].replace(/tmp\.|\.html|\.htm/g,"");var argstemplates=/,/g.test(str_template)?str_template.split(","):str_template;var getMainJs=function(one){if(one===false||one==="false"){requireArrs.shift()}else{if(one===true||one==="true"){requireArrs.shift()}var newCallback=argstemplates instanceof Array?argstemplates[argstemplates.length-1]:argstemplates;if(jQuery.inArray(newCallback,requireArrs)==-1){requireArrs.push(newCallback)}}};if(requireArrsOne instanceof Array){if(argstemplates instanceof Array){var atLen=argstemplates.length;var raoLen=requireArrsOne.length;for(var g=0;g<raoLen;g++){if(argstemplates[g]&&requireArrsOne[g]==true){requireArrs.push(argstemplates[g])}}if(raoLen<atLen){requireArrs.push(argstemplates[atLen-1])}}else{getMainJs(requireArrsOne[0])}requireArrs.shift()}else{getMainJs(requireArrsOne)}};args["fn"]=requireArrs;var errTimer=null;require(requireArrs,function(){dorender()},function(err){clearTimeout(errTimer);errTimer=setTimeout(function(){dorender()},50)});function dorender(){if(Control.isPolling&&Configs.HomePage){var modules=["mainContent","sider"]}else{var modules=Configs.Modules.Renders}var templates=Configs.Template.content;var datas=Configs.Data.content;var datas_maincontent=datas["mainContent"];var modulesLength=modules.length;var name=args["name"];var doRender=args["render"];var htmlDatas="";if(modulesLength<=0){return false}else if(modulesLength==1){var iModuleName=modules[0];var iModule=document.getElementById(iModuleName);var templatehtml=templates[iModuleName];if(!templatehtml){return}var data={"args":args,"data":{}};data["data"]=GetDatasFromName(name,data["data"]);if(data.data&&iModule&&templatehtml!=""){that.PromptEvent.Loading({remove:iModuleName});Pages.Int=null;if(doRender=="artTemplate"){data["jQuery"]=data["$"]=jQuery;data["Configs"]=Configs;data["Pages"]=Pages;data["Control"]=Control;data["Validates"]=Validates;data["window"]=window;try{var render=template.compile(templatehtml);htmlDatas=render(data);HTMLModule(iModule,htmlDatas,iModuleName,data,true)}catch(err){CatchError(iModuleName,err)}}else{try{htmlDatas=doT.template(templatehtml)(data);HTMLModule(iModule,htmlDatas,iModuleName,data,true)}catch(err){CatchError(iModuleName,err)}}}}else{for(var i=0,ilen=modules.length;i<ilen;i++){var iModuleName=modules[i];var iModule=document.getElementById(iModuleName);var name=args["name"];var data={"args":args,"data":{}};var templatehtml=templates[iModuleName];if(!templatehtml){continue}data["data"]=GetDatasFromName(name,data["data"]);if(datas_maincontent&&datas_maincontent['subMenu']){data['data']['subMenu']=datas_maincontent['subMenu']}if(data.data&&iModule&&templatehtml!=""){that.PromptEvent.Loading({remove:iModuleName});Pages.Int=null;if(doRender=="artTemplate"){data["jQuery"]=data["$"]=jQuery;data["Configs"]=Configs;data["Pages"]=Pages;data["Control"]=Control;data["Validates"]=Validates;data["window"]=window;try{var render=template.compile(templatehtml);htmlDatas=render(data);HTMLModule(iModule,htmlDatas,iModuleName,data,i==ilen-1)}catch(err){CatchError(iModuleName,err)}}else{try{htmlDatas=doT.template(templatehtml)(data);HTMLModule(iModule,htmlDatas,iModuleName,data,i==ilen-1)}catch(err){CatchError(iModuleName,err)}}}}};function HTMLModule(target,htmls,iModuleName,idata,last){$(target).children().off();if(target){$(target).html(htmls)}switch(iModuleName){case"header":case"sider":case"mainBar":case"footer":if($.type(Pages[iModuleName])=="function"){Pages[iModuleName](idata)}break;default:if($.type(Pages[iModuleName])=="function"){Pages[iModuleName](idata)}Pages.CallBack(idata)}if(!Configs.Alarm.expand&&(iModuleName=="mainBody"||iModuleName=="mainContent")){that.SetLayout();if(jQuery.cookie("GHMI")=="yes"){that.ScreenSaver()}};if(last){that.StartPolling()}};function CatchError(iModuleName,err){if(!that.isPolling){var target="";if(iModuleName=="mainBody"){target=$("#mainBody")}else{target=$("#mainContent")};setTimeout(function(){that.PromptEvent.Tip({target:target,text:Language.Html["047"]+"<span class='error-tip'>"+(err.message||err)+"</span>",clear:true})},100)}};function GetDatasFromName(name,data){if(name&&name!=""){var nameArr=name.split(","),nameArrLength=nameArr.length;if(!datas_maincontent){datas_maincontent=datas[iModuleName]}if(datas_maincontent){if(nameArrLength>1){for(var j=0;j<nameArrLength;j++){data[nameArr[j]]=datas_maincontent[nameArr[j]]||{}}}else{data=datas_maincontent[name]||{}}}else{data={}}}else{if(args['idata']&&args['idata']!=""&&datas[args['idata']]){data=datas[args['idata']]}else if(datas[iModuleName]){data=datas[iModuleName]}else{data={}}};if(datas_maincontent){if(datas_maincontent["COMMON"]){data["COMMON"]=datas_maincontent["COMMON"]}}return data};that.SetNavigation()}},ResetLayout:true,SetLayout:function(a){var doc=document;var H=[126,35,0,40,198,28],H_window=$(window).height(),H_body=$(doc).height(),container=$(doc.getElementById("container")),content=$(doc.getElementById("content")),mainTab=$(doc.getElementById("mainTab")),mainBody=$(doc.getElementById("mainBody")),alarm=$(doc.getElementById("alarm")),alarmList=$(doc.getElementById("alarmList")),alarmContent=$(doc.getElementById("alarmContent")),alarmHandle=$("a.alarmHandle");alarm.css({"z-index":"100000"});var ghmi=jQuery.cookie("GHMI");var loclantype=jQuery.cookie("loc_lang_type");var alarmsound=jQuery.cookie("alarmsound");var alarmwidth="250px";if(ghmi=="yes"&&loclantype!=6&&loclantype!=7){alarmwidth="290px"}if(alarmsound==1&&ghmi=="yes"){alarmwidth="400px";$("#AlmSoundOff").show()}if(a){var h=container.height();alarm.css({"height":h-38,"right":alarmwidth});alarmList.css("height",h-60-37);alarmList.find("div.tab_item").eq(0).removeClass("hide");$.each(alarmList.find("div.tab_item"),function(index){if(index==0){if($(this).hasClass("hide")){$(this).removeClass("hide")}}else{if(!$(this).hasClass("hide")){$(this).addClass("hide")}}});alarmContent.show();alarmHandle.removeClass("alarmOpen").addClass("alarmClose")}else{if(Configs.Alarm.show){alarmHandle.removeClass("alarmOpen").addClass("alarmClose");alarm.css({"height":H[4],"right":alarmwidth});alarmContent.show()}else{alarmHandle.removeClass("alarmClose").addClass("alarmOpen");alarm.css({"height":H[5],"right":alarmwidth});alarmList.css({"height":141});alarmContent.hide();var alarmTip=$(doc.getElementById("PromptTip_alarm"));var alarmLoading=$(doc.getElementById("PromptLoading_alarm"));alarmTip.add(alarmLoading).css({"top":0})}var sider=$(doc.getElementById("sider"));var sideHeight=575+H[0]+H[1]-1;var H_content=(H_window<sideHeight?sideHeight:H_window)-H[0]-H[1];container.css("height",H_content-H[2]);content.css("height",H_content);var H_mainBodyNew=H_content-H[2]-(mainTab[0]?H[3]:0)-H[5]-10-(/IE/gi.test(Configs.Browser)?2:1);mainBody.css("height",H_mainBodyNew+39).scrollTop(Configs.MainScrollHeight)}var t2=document.getElementById("history_t2");if(t2){var HistorySummary=mainBody.find("#history_summary");var t1=mainBody.find("#history_t1");$(t2).height(mainBody.height()-HistorySummary.outerHeight(true)-t1.outerHeight(true)-48)}$(".extbackground").css({"min-height":H_window-H[0]-H[1]-H[3],"height":mainBody.height()});$("#Setting_TL1_Signal .table-container,.set-form-TL1-signal").css({"height":$("#mainBody").height()-($(".TL1-signal-summary").outerHeight()+5)});$("#Setting_TL1_Signal .table-body").css({"height":$("#mainBody").height()-($(".TL1-signal-summary").outerHeight()+5)-($("#Setting_TL1_Signal .table-container .table-title").height()+21)});if(this.ResetLayout){if($("#mainBody").height()==300){var that=this;setTimeout(function(){that.SetLayout()},100)}else{this.ResetLayout=false}}},SetNavigation:function(args){args=args?args:Configs.Template.info;if(args.disabledNav){return}if($.type(args["currentMenu"])!="array"){var tabCurrent=/#/g.test(args["currentMenu"])?$(args["currentMenu"]):$("#"+args["currentMenu"]);if(!tabCurrent[0]){return false}tabCurrent=tabCurrent[0]?tabCurrent:null;if(tabCurrent!=null){tabCurrent.addClass("currentMenu")}}var currentList=$(args["currentMenu"][0]);var navigation=Configs.Navigation;var menuIndex=Number(args["menuIndex"]);var currentMenu="currentMenu";var text=args["text"];var mainBar=$("#mainBar");var mainTab=$("#mainTabContent")[0]?$("#mainTabContent"):$("#mainTab");if(menuIndex==0){navigation.nav.length=1;navigation.nav[0]="<i>"+text+"</i>";currentList.removeClass(currentMenu).eq(args["currentMenu"][1]).addClass(currentMenu)}else if(menuIndex==1){var text2=$.trim(mainTab.find("a:first").text());if(args["currentMenu"][1]==0){navigation.nav.length=1;navigation.nav[0]="<i>"+text2+"</i>"}else{if(text2==""){navigation.nav.length=1}else{navigation.nav.length=2;navigation.nav[1]="<i>"+text2+"</i>"};navigation.nav[0]="<i>"+text+"</i>"};currentList.removeClass(currentMenu).eq(args["currentMenu"][1]).addClass(currentMenu)}else if(menuIndex==2){navigation.nav.length=2;navigation.nav[1]="<i>"+text+"</i>";var current=currentList.eq(args["currentMenu"][1]);if(current[0]){currentList.removeClass(currentMenu);current.addClass(currentMenu)}else{}};if(navigation['nav'][0]==navigation['nav'][1]){navigation['nav'].pop()}var mainBarData={"nav":navigation['nav'].join(Configs.Navigation.space),"navsp":Configs.Navigation.space};var htmlDatas="";try{var doTtmpl=doT.template(Configs.Template.content['mainBar']);htmlDatas=doTtmpl(mainBarData)}catch(err){}if(mainBar[0]){mainBar[0].innerHTML=htmlDatas}},StartPollingAlarm:function(){var that=this;if(this.AlarmXHR||this.AlarmXHR!=null){this.AlarmXHR.abort();this.AlarmXHR=null};this.pollingAlarm=setTimeout(function(){that.isAlarmPolling=true;that.GetAlarms();that.pollingAlarm=null},Configs.Alarm.interval)},StopPollingAlarm:function(){if(this.pollingAlarm){clearTimeout(this.pollingAlarm);this.pollingAlarm=null}if(this.AlarmXHR||this.AlarmXHR!=null){this.AlarmXHR.abort();this.AlarmXHR=null}},GetAlarms:function(){var that=this;if(Configs.Alarm.requestCount>=Configs.Alarm.refresh){Configs.Alarm.requestCount=0;that.alarmEtag="0123456789abcdefghijklmnopqrstuvwxyz";Configs.Alarm.cache="0123456789abcdefghijklmnopqrstuvwxyz";that.isAlarmPolling=false};Configs.Alarm.requestCount++;that.AlarmXHR=$.ajax({timeout:Configs.Alarm.timeout,dataType:"html",headers:{"If-None-Match":that.isAlarmPolling?that.alarmEtag:""},url:Configs.Alarm.url+"?_="+new Date().getTime(),beforeSend:function(){if(!that.isAlarmPolling){that.PromptEvent.Loading({target:"alarm",interval:200,clear:false})}},success:function(data,textStatus,jqXHR){if(jqXHR.status==200){that.alarmEtag=jqXHR.getResponseHeader("Etag");var re=new RegExp(Configs.Data.endStr,'g');if(re.test(data)){data=data.replace(Configs.Data.endStr,"")}else{Configs.Alarm.cache=data;if(!that.isAlarmPolling){setTimeout(function(){that.PromptEvent.Tip({target:"alarm",text:Language.Html["005"],Class:"alarm-prompt"})},200)}that.StartPollingAlarm();return}if(Configs.Alarm.cache==data&&Configs.refreshalarm){Configs.refreshalarm=true;if(that.isAlarmPolling){that.StartPollingAlarm();return}};Configs.Alarm.cache=data;try{data=jQuery.evalJSON(data)}catch(e){if(!that.isAlarmPolling){setTimeout(function(){that.PromptEvent.Tip({target:"alarm",text:Language.Html['001'],Class:"alarm-prompt"})},200)}that.StartPollingAlarm();return}}else if(jqXHR.status==304){that.StartPollingAlarm();return}Configs.Alarm.data=data;jQuery.cookie("alarmsound",data.Alarms_sound,{path:"/"});if(data.timeformat){jQuery.cookie("timeformat",data.timeformat,{path:"/"})}else{jQuery.cookie("timeformat",0,{path:"/"})}Pages.SetCommons();if(!Configs.Template.content['alarm']){Configs.Template.content['alarm']=$("#tmp_alarm").html()}that.PromptEvent.Loading({remove:"alarm"});if(Configs.Template.content['alarm']&&data){var alarm=$("#alarm");try{var doTtmpl=doT.template(Configs.Template.content['alarm']);if(alarm[0]){alarm.html(doTtmpl(data))}}catch(err){if(!that.isAlarmPolling){setTimeout(function(){that.PromptEvent.Tip({target:alarm,text:Language.Html["047"],clear:true,Class:"alarm-prompt"})},100)}};Pages.alarm(data)}that.isAlarmPolling=true;that.StartPollingAlarm();that.PromptEvent.TipRemove({"remove":"alarm"})},error:function(data,textStatus){that.alarmEtag="";Configs.Alarm.cache="";if(textStatus!="abort"){that.DealError(textStatus,null,Configs.Alarm)}}}).always(function(jqXHR,textStatus,errorThrown){jqXHR=null;textStatus=null;errorThrown=null;that.AlarmXHR=null})},SetAlarmPopup:function(){jQuery.cookie("alarmAutoPop",jQuery.cookie("alarmAutoPop")||Configs.Alarm.auto,{path:"/"})},StartPollingTrend:function(interval){if(this.TrendXHR||this.TrendXHR!=null){this.TrendXHR.abort()};if(interval){var time=interval}else{var time=Configs.Trend.interval}var that=this;this.pollingTrend=setTimeout(function(){clearTimeout(that.pollingTrend);that.GetTrend()},time)},StopPollingTrend:function(){if(this.pollingTrend){clearTimeout(this.pollingTrend)}if(this.TrendXHR||this.TrendXHR!=null){this.TrendXHR.abort();this.TrendXHR=null}},GetTrend:function(refresh){var that=this;if(refresh){that.trendEtag=new Date().getTime()}this.TrendXHR=$.ajax({timeout:Configs.Data.timeout,dataType:"html",headers:{"If-None-Match":that.isTrendPolling?that.trendEtag:""},beforeSend:function(){if(!that.isTrendPolling){that.PromptEvent.Loading({target:"Trend",interval:200,marginTop:"center",clear:false})}},url:Configs.Trend.url+"?_="+new Date().getTime(),success:function(data,textStatus,jqXHR){if(jqXHR.status==200){that.trendEtag=jqXHR.getResponseHeader("Etag");if(Configs.Trend.failNum>=Configs.Trend.failMax){trendReload();return};var re=new RegExp(Configs.Data.endStr,'g');if(re.test(data)){data=data.replace(Configs.Data.endStr,"")}else{Configs.Trend.dataCache=data;Configs.Trend.failNum++;Configs.Trend.fail_200=true;that.StartPollingTrend(Configs.Trend.tempInterval);return}if(Configs.Trend.dataCache==data){that.StartPollingTrend(Configs.Trend.tempInterval);return};Configs.Trend.dataCache=data;try{data=jQuery.evalJSON(data);Configs.Trend.failNum=0;Configs.Trend.fail_200=false}catch(e){Configs.Trend.failNum++;Configs.Trend.fail_200=true;if(!$("#Trend_canvas")[0]){that.PromptEvent.Tip({target:"Trend",text:Language.Html['001'],marginTop:"center"})}that.StartPollingTrend(Configs.Trend.tempInterval);return}}else if(jqXHR.status==304){if(Configs.Trend.fail_200){Configs.Trend.failNum++;if(Configs.Trend.failNum>=Configs.Trend.failMax){trendReload();return}};if(Configs.Trend.data.value){that.StartPollingTrend()}else{that.StartPollingTrend(Configs.Trend.tempInterval)}return};Configs.Trend.data_y=$.extend(true,{},Configs.Trend.data_y,data);if(data.totalCurrent!=0){for(var v=0,vlen=data.value.length;v<vlen;v++){data.value[v][1]=(data.value[v][1]/data.totalCurrent)*100}};Configs.Trend.data=data;that.isTrendPolling=true;that.StartPollingTrend();Pages.HomeTrend()},error:function(data,textStatus){if(Configs.Trend.fail_200&&Configs.Trend.failNum!=0){Configs.Trend.fail_200=false;Configs.Trend.failNum=0}Configs.Trend.failNum++;if(Configs.Trend.failNum>=Configs.Trend.failMax){if(Configs.wrapper.is(":hidden")){Configs.Trend.fail_200=false;Configs.Trend.failNum=0;return false}trendReload();return}that.StartPollingTrend(Configs.Trend.tempInterval)}}).always(function(jqXHR,textStatus,errorThrown){jqXHR=null;textStatus=null;errorThrown=null;that.TrendXHR=null});function trendReload(reloadNum){if(!that.isTrendPolling){that.PromptEvent.Tip({target:"Trend",text:Language.Html['002']+Configs.Prompt.refresh_trend,marginTop:"center"})};if(!reloadNum){Configs.Trend.failNum=0}else{Configs.Trend.failNum=reloadNum}}},KeepLoginPolling:null,StopKeepLogin:function(){clearTimeout(this.KeepLoginPolling);this.KeepLoginPolling=null},KeepLogin:function(){var that=this;function PostData(){var XHR=$.ajax({timeout:Configs.Alarm.timeout,url:"/app/www_user/html/cgi-bin/web_cgi_control.cgi?_="+new Date().getTime(),data:"equip_ID=1&control_type=16&sessionId="+jQuery.cookie("sessionId"),success:function(data,textStatus,jqXHR){try{var datas=jQuery.evalJSON(data);if(datas.status==1){Pages.footer({data:{present_time:datas.content[0]}})}}catch(Error){}datas=null},error:function(data,textStatus){}}).always(function(jqXHR,textStatus,errorThrown){jqXHR=null;textStatus=null;errorThrown=null;XHR=null;that.KeepLoginPolling=setTimeout(function(){PostData()},5000)})};PostData()},MouseMoveTimer:null,ReloadTimer:null,Reload:function(){var that=this;this.ReloadTimer=setTimeout(function(){clearTimeout(that.ReloadTimer);that.ReloadTimer=null;that.RemoveFrames(true);location.reload()},900000)},StopReload:function(){clearTimeout(this.MouseMoveTimer);clearTimeout(this.ReloadTimer);Configs.StopReload=true},RemoveFrames:function(reload){var frame=$("iframe");if(frame.length>0){for(var i=0,ilen=frame.length;i<ilen;i++){var f=frame.eq(i);if(f.attr("keep")!=""){break}else{f[0].src="about:blank";f[0].contentWindow.document.write('');f[0].contentWindow.close();f[0].contents().children().off().remove();f.remove();f=null}}if(/IE/g.test(Configs.Browser)){CollectGarbage()}}if(reload){$("#contextmenu").remove();$("body").off();$(document).off();Configs.wrapper.html('')}},Initialization:function(){var that=this;this.CheckReLogin();Configs.timezone=new Date().getTimezoneOffset()/60;Configs.wrapper=$(document.getElementById("wrapper"));Configs.Browser=$.isBrowser();Configs.Prompt={status:false,module:null,refresh:"<a href='#' onclick='Control.RefreshModule();return false;' class='PromptRefresh'>"+Language.Html['027']+"</a>",refresh_trend:"<a href='#' onclick='Control.GetTrend(true);return false;' class='PromptRefresh'>"+Language.Html['027']+"</a>",relogin:"<a href='#'class='btn_set' onclick='Control.LoginOut();return false;'><i>"+Language.Html['024']+"</i></a>",retry:"<a href='#' class='btn_set resetSendSubmit' onclick='return false;'><i>"+Language.Html['017']+"</i></a>",cancel:"<a href='#' class='btn_set close' onclick='return false;'><i>"+Language.Html['015']+"</i></a>"};var keyupTimer=null;$(document).off().on("keydown",function(event){var key=event.keyCode;if(key==116){return false}else if(key==27){if(/IE/g.test(Configs.Browser)){return false}}else if(key==8){if(!Configs.Backspace){return false}}else if(event.ctrlKey&&key==82){}}).on("contextmenu",function(e){var PromptCover=$("#PromptCover")[0];if(PromptCover){return false};var rdiv=document.getElementById("contextmenu");if(e.which===3||e.which===0){if(rdiv){rdiv.style.visibility="visible"}else{var rdiv=document.createElement("div");rdiv.id="contextmenu";rdiv.className="contextmenu";rdiv.innerHTML=["<ul>","<li><a href='#' onclick='Control.RefreshModule();return false;'>"+Language.Html["034"]+"</a></li>","<li><a href='#' onclick='Control.RemoveFrames(true);location.reload();return false;'>"+Language.Html["035"]+"</a></li>","</ul>"].join("");$("body")[0].appendChild(rdiv)};var pLeft,pTop,winwidth=$(window).width(),winheight=$(window).height(),width=$(rdiv).outerWidth(true),height=$(rdiv).outerHeight(true);if(e.clientX+width>winwidth){pLeft=winwidth-width-5}else{if(e.clientX<=0){pLeft=5}else{pLeft=e.clientX}};if(e.clientY+height>winheight){pTop=winheight-height-5}else{if(e.clientY<=0){pTop=5}else{pTop=e.clientY}}var scrolltop=$(window).scrollTop()||0;$(rdiv).css({"left":pLeft,"top":pTop+scrolltop})}if($("div.table-body ul.select")[0]){$("ul.select").removeClass("select")}return false}).on("click",function(e){if(jQuery.cookie("alarmsound")==1){$("#AlmSoundOff").hide();$("#alarm").css("right","290px")}if(e.which!==3){var rdiv=document.getElementById("contextmenu");if(rdiv){rdiv.style.visibility="hidden"}if(Pages.SystemPop){$("div.system-popup").hide();Configs.Popup.index=null;Configs.Popup.status=false}}if(e.target.nodeName=="BODY"){if($("div.table-body ul.select")[0]){$("ul.select").removeClass("select");Configs.Data.setting={};Configs.HighLight=null}}}).on("mousemove",function(){if(Configs.HomePage||Configs.StopReload){return}clearTimeout(that.ReloadTimer);that.ReloadTimer=null;clearTimeout(that.MouseMoveTimer);that.MouseMoveTimer=setTimeout(function(){that.Reload();mousemove_timer=null},5000)}).on("mouseup",function(e){if(Configs.SelectFocus!=null){var t=$(e.target);var type=(t.attr("type")||t[0].nodeName).toLowerCase();if(type=="option"){t=t.parent()}if(!t.is(Configs.SelectFocus)){Configs.SelectFocus.blur()}}});that.Reload();if(!this.CheckLogin()){return false};this.SetAlarmPopup();var modules=Configs.Modules.Defaults;for(var i=0,ilen=modules.length;i<ilen;i++){var template=document.getElementById(Configs.Template.prefix+modules[i]);if(template){Configs.Template.content[modules[i]]=template.innerHTML}};var resize_timer=0;$(window).resize(function(){clearTimeout(resize_timer);resize_timer=setTimeout(function(){that.SetLayout();var Cover=document.getElementById("PromptCover");if(Cover){that.PromptEvent.Cover({target:Cover})}that.PromptEvent.Loading({reset:true,marginTop:that.PromptEvent.ResetStatus});Control.RefreshModule(Configs.refresh)},200);var mainBody=document.getElementById("mainBody");if(mainBody){$(mainBody).trigger("scroll")}});$("body").on("click",function(){var contextmenu=document.getElementById("contextmenu");if(contextmenu){$(contextmenu).css({"visibility":"hidden"})}if(jQuery.cookie("alarmsound")==1&&jQuery.cookie("GHMI")=="yes"){$.ajax({type:"POST",url:"../cgi-bin/web_cgi_control.cgi?_="+new Date().getTime(),data:"control_value=0&equip_ID=1&signal_type=2&signal_id=500&value_type=5&control_type=1&sessionId="+jQuery.cookie('sessionId'),success:function(data){jQuery.cookie("alarmsound",0,{path:"/"})},error:function(data,textStatus){that.PromptEvent.Tip({target:args["modules"],text:Language.Html['003']+Configs.Prompt.refresh})}})}});var indexDatas={"menuIndex":1,"template":Configs.Template.info["template"],"modules":"mainContent","currentMenu":["ul.sider-list a",0],"fn":[false,"HomePage"],"level":jQuery.cookie("nAuthority"),"sessionId":jQuery.cookie('sessionId'),"data":Configs.Template.info["data"]};that.GetTemplate(indexDatas);$.history.init(indexDatas);var cookie_items=document.cookie.split(";");for(var i=0,ilen=cookie_items.length;i<ilen;i++){var tmp_arr=cookie_items[i].split("=");Configs.Cookies.names.push($.trim(tmp_arr[0]))};that.GetTrend();that.GetAlarms();that.KeepLogin();setTimeout(function(){Configs.test_timer=true},5000)},timer:null,ScreenSaver:function(){var that=this;document.onmousemove=document.onclick=function(){clearTimeout(that.timer);bindevent()};function bindevent(){clearTimeout(that.timer);that.timer=setTimeout(function(){Control.LoginOut();jQuery.cookie("login_timeout",1,{path:"/"})},600000)}bindevent()}};
/*!
 * Author: Jerman.Xie | xieguishi@126.com
 * Date: 2013.09
 *
 * Views控制器:
 * 负责页面各种展示效果
 * 负责页面中的各种事件
 */
;var Pages={DelArrayValue:function(arr,value){if($.type(arr)!="array"||$.type(value)!="array"){return arr}for(var i=0,ilen=arr.length;i<ilen;i++){for(var j=0,jlen=value.length;j<jlen;j++){if(arr[i]==value[j]){arr.splice(i,1)}}};return arr},GetUTCtime:function(current){var starttime=new Date("1970/01/01 00:00:00").getTime()/1000;return new Date((current+starttime)*1000)},GetAttrData:function(target){var $this=$(target);if(!target){return''}var data=jQuery.evalJSON($this.attr('data').replace("{,","{"));if(!data["fn"]){data['fn']=null}if(!data['modules']){data['modules']="mainContent"}if(!data['menuIndex']){data['menuIndex']=1}data['text']=data['title']?data['title']:$this.text()||"";if(!data['currentMenu']){var pNodeName=$this.parent()[0].nodeName;switch(pNodeName){case"DIV":var pid=$this.parent().attr("id");if(pid){if(pid=="mainTab"){var tIndex=$this.index();data['currentMenu']=["#mainTab a",tIndex]}else if(pid=="mainTabContent"){var tIndex=$this.index();data['currentMenu']=["#mainTabContent a",tIndex]}else{data['currentMenu']=["#"+pid+" a",0]}}else{var pclass=$this.parent().attr("class");if(pclass){data['currentMenu']=["."+$this.parent().attr("class").split(" ")[0]+" a",0]}else{data['currentMenu']=["#mainContent a",0]}}break;case"LI":var tIndex=$this.parent().index();data['currentMenu']=["ul.sider-list a",tIndex];break;default:data['currentMenu']=[]}}data['sessionId']=jQuery.cookie("sessionId");data['level']=Number(jQuery.cookie("nAuthority"));data['language_type']=Number(jQuery.cookie("language_type"));return data},InitData:function(data){Configs.HighLight=null;Configs.Modules.Defaults=["mainBar","mainContent"];Configs.Popup.Data=null;Configs.Data.render=true;$.history.set(data);$("#mainBody").css("overflow-y","auto");Configs.PowerSystem=[];var timers=Configs.tmpTimer;if(timers){for(var i=0,ilen=timers.length;i<ilen;i++){clearTimeout(timers[i]);clearInterval(timers[i])}}var cacheData=$("#"+data["modules"]);if(cacheData[0]){cacheData.removeData()}},bindEvent:function(evt,eleid,popEle){var that=this;var ele=$(eleid);if(ele.length>0&&popEle){ele.off().on(evt,popEle,function(event){var $this=$(this);if($this.parent()[0].id=="mainTabContent"){var mainContent=$("#mainContent");var tabCache=mainContent.data("tabs");if(tabCache&&mainContent[0]){mainContent.data("tabs").TabsCurrent=$this}}if(!$this.attr("data")){return false};try{var data=that.GetAttrData($this)}catch(err){alert(Language.Html["030"]);return false}that.InitData(data);Control.GetTemplate(data);return false})};ele=null},setScroll:function(){var mainBody=$("#mainBody"),self=this;if(mainBody[0]){mainBody.off("scroll").on("scroll",function(){Configs.MainScrollHeight=$(this).scrollTop();clearTimeout(self.scroll_timer);self.scroll_timer=setTimeout(function(){self.ResetHighLight(true)},100)})}$(document).off("scroll").on("scroll",function(){Configs.bodyScroll=$(this).scrollTop()})},ResetHighLight:function(scroll){var doc=document,mainBody=$(doc.getElementById("mainBody")),HighLight=doc.getElementById(Configs.HighLight);if(HighLight){$(HighLight).addClass("select");if(scroll){var top=$(HighLight).offset().top;if(top<170||top-mainBody.height()>140){$(HighLight).removeClass('select');Configs.HighLight=null;var Eles=$(HighLight).find(".set_value");var isRadio=Eles.find("input");if(isRadio.length>0){isRadio.eq(0).prop("checked",true)}else{Eles.val("").blur()}Configs.Data.setting={}}else{}}}if(!scroll){mainBody.scrollTop(Configs.MainScrollHeight)}},TabsNavIndex:function(as,parent,sw,tabsData){var asLen=as.length;var pages=[];var mw=$(parent).innerWidth();if(mw<=sw){return false}var aw=0;for(var i=0,ilen=as.length;i<ilen;i++){var asi=as.eq(i);var asiWidth=asi.outerWidth(true);aw+=asiWidth;if(aw>sw){pages.push(i);aw=asiWidth}};var alist=[];for(var p=0,plen=pages.length;p<=plen;p++){if(p==0){alist.push(as.slice(0,pages[p]))}else if(p==plen){alist.push(as.slice(pages[p-1],asLen))}else{alist.push(as.slice(pages[p-1],pages[p]))}}tabsData.TabsPage=alist;return true},BindSelect:function(pageobj){$(".input_select").off().click(function(event,pro){var setTop=$(this).offset().top;if(pro!="tig"){var cutobj=$(this).next(".language");var optionheight=cutobj.find("li").length*19;cutobj.css({"width":""+Number($(this).width()+7)+"px"});if(cutobj.hasClass("yinc")){if(optionheight>(document.documentElement.clientHeight-setTop-22-35)){if(optionheight>setTop){if(document.documentElement.clientHeight-setTop-22-35>19*3){cutobj.css({"margin-top":"0px","height":document.documentElement.clientHeight-setTop-22-35-10,"overflow":"auto"})}else{cutobj.css({"margin-top":"-"+(optionheight+21-(optionheight-(setTop-166-10)))+"px","height":""+setTop-166-10+"px","border-bottom":"0px","border-top":"1px","overflow":"auto"})}}else{if(optionheight>setTop-166){cutobj.css({"margin-top":"-"+(optionheight+21-(optionheight-(setTop-166-10)))+"px","height":""+setTop-166-10+"px","border-bottom":"0px","border-top":"1px","overflow":"auto"})}else{cutobj.css({"margin-top":"-"+(optionheight+21)+"px","height":"auto","border-top":"1px #8F8F8F solid"})}}}else{cutobj.css({"margin-top":"0px","height":"auto"})}cutobj.slideDown(50).removeClass("yinc");cutobj.find("li").slideDown(50).removeClass("yinc")}else{cutobj.slideUp(10).addClass("yinc");cutobj.find("li").slideUp(10).addClass("yinc")}}});$(document).off("click").click(function(event){if($(event.target).prop("className")!="input_select set_value"&&$(event.target).prop("className")!="language"&&$(event.target).prop("className")!="input_select set_value set_newval"){$(".language").slideUp(20).addClass("yinc");$(".language").find("li").slideUp(20).addClass("yinc");Configs.SelectFocus=null;Configs.Data.render=true}$(".input_select").next(".language").not($(event.target).next(".language")).slideUp(20).addClass("yinc");$(".input_select").next(".language").not($(event.target).next(".language")).find("li").slideUp(20).addClass("yinc")});$(".language li").click(function(event){$(this).parent().prev(".input_select").text($(this).text()).attr("data-index",$(this).find("a").attr("rel"));$(this).parents(".language").slideUp(10).addClass("yinc");$(this).parents(".language").find("li").slideUp(10).addClass("yinc");var oElem=event.target?event.target:event.srcElement;if($(oElem).parents(".dropdown").find("div").prop("id")=="AID_Equip"){if(pageobj!=""&&pageobj!=undefined&&pageobj!=null){pageobj()}}else if($(oElem).parents(".dropdown").find("div").prop("id")=="AID_Group"){return false}else{if(pageobj!=""&&pageobj!=undefined&&pageobj!=null){pageobj($(this).parent().prev())}}})},BindRadio:function(){$(".radiodiv").click(function(){if($(this).hasClass("radiodivnot")){$(this).parent(".set_value").children().not(".radiodivnot").addClass("radiodivnot");$(this).removeClass("radiodivnot")}})},BindCheckBox:function(){$(".divcheckbox").click(function(){if($(this).hasClass("divchecked")){$(this).removeClass("divchecked")}else{$(this).addClass("divchecked")}})},TabsNavSlice:function(data){var mainTabContent=$("#mainTabContent");if(!mainTabContent[0]){return false}var sw=1110,that=this;var mainContent=$("#mainContent"),mainTab=$("#mainTab");mainContent.data("tabs",{TabsPage:[],TabsPageCurrent:0,TabsCurrent:null});var tabsData=mainContent.data("tabs");var as=mainTabContent.find("a"),ac=mainTabContent.find("a.currentMenu");tabsData.TabsCurrent=ac;var hasPage=this.TabsNavIndex(as,mainTabContent,sw,tabsData);var btnLeft=mainTab.find("a.tab-al"),btnRight=mainTab.find("a.tab-ar");var ClassRD="tab-ar-disabled",ClassLD="tab-al-disabled";if(hasPage){btnRight.removeClass(ClassRD)}else{btnRight.addClass(ClassRD);return}mainTabContent.html(tabsData.TabsPage[0]);var checkmenu=function(){mainTabContent.html(tabsData.TabsPage[tabsData.TabsPageCurrent]);var acc=mainTabContent.find("a.currentMenu");if(!acc.is(tabsData.TabsCurrent)){acc.removeClass("currentMenu")}that.bindEvent("click",mainTabContent,"a")};btnRight.off("click").on('click',function(){if($(this).hasClass(ClassRD)){return false}tabsData.TabsPageCurrent++;checkmenu();btnLeft.removeClass(ClassLD);if(tabsData.TabsPageCurrent==tabsData.TabsPage.length-1){$(this).addClass(ClassRD)}});btnLeft.off("click").on('click',function(){if($(this).hasClass(ClassLD)){return false}tabsData.TabsPageCurrent--;checkmenu();btnRight.removeClass(ClassRD);if(tabsData.TabsPageCurrent==0){$(this).addClass(ClassLD)}})},ReviseRadio:function(){var fieldsetobj=$("fieldset");for(var i=0;i<fieldsetobj.length;i++){var outwidth=$("fieldset").eq(i).width();var radiowidth=0;$.each($("fieldset").eq(i).children(),function(){radiowidth+=$(this).outerWidth(true)});if(radiowidth>=outwidth){$("fieldset").eq(i).find("div").css({"margin-top":"5px"})}}},bindInput:function(){$("input").off("focus blur keydown").on("focus",function(){if(!$(this).attr("readonly")){Configs.Backspace=true}}).on("blur",function(){Configs.Backspace=false}).on("keydown",function(){if($(this).hasClass("set_value")){Configs.Backspace=true}})},CallBack:function(data){var fn=data.args['fn']||[];for(var i=0,ilen=fn.length;i<ilen;i++){if(fn[i]&&$.type(this[fn[i]])==="function"){this[fn[i]](data)}};this.bindInput();this.ResetHighLight()},mainContent:function(data){var ModuleLoading=document.getElementById("ModuleLoading");if(ModuleLoading&&$(ModuleLoading).is(":visible")){ModuleLoading.style.display="none";ModuleLoading=null}this.bindEvent("click","#mainTab","a");this.setScroll();this.TabsNavSlice(data)},mainBody:function(data){this.setScroll()},footer:function(data,obj){var isData=data&&data.data;var dataFormat=isData&&data.data.time_format;var isTime=isData&&data.data.present_time;if(dataFormat){Configs.TimeFormat=data.data.time_format}var that=this;var timezone=new Date().getTimezoneOffset()/60;var system_time=$("#SystemTime").find("span")[0];if(isTime){var current=data.data.present_time}else if(Configs.SystemTime!=""){current=new Date(Configs.SystemTime-timezone*3600).getTime()/1000}if(!current){return}var timeStr="";function set_current_time(){var time=new Date(1000*(current+timezone*3600));var year=time.getFullYear();var month=Validates.MakeupZero(time.getMonth()+1);var day=Validates.MakeupZero(time.getDate());var hour=Validates.MakeupZero(time.getHours());var minute=Validates.MakeupZero(time.getMinutes());var second=Validates.MakeupZero(time.getSeconds());var HMS=hour+":"+minute+":"+second;var timefomat=jQuery.cookie("timeformat");switch(Number(timefomat)){case 0:timeStr+=day+"-"+month+"-"+year;break;case 1:timeStr+=month+"-"+day+"-"+year;break;case 2:timeStr+=year+"-"+month+"-"+day;break};if(obj=="page_h"){timeStr+=" "+hour}else{timeStr+=" "+HMS}timeStr=timeStr.replace(/-/g,"/");if(obj!="page"&&obj!="page_h"&&obj){obj.val(timeStr)}else if(!obj){Configs.SystemTime=year+"/"+month+"/"+day+" "+HMS;if(system_time){system_time.innerHTML=timeStr}}}set_current_time();if((obj=="page"||obj=="page_h")&&obj){return timeStr}},changetime:function(time){var mdh=time.split(" ");if(mdh[1].indexOf(":")<0){time=time+":00:00"}var set_date = Validates.CheckDate(time.replace(/-/g,"/").split(" ")[0]);var times=Date.parse(time.replace(/-/g,"/"))/1000-Configs.timezone*3600;var timefomat=jQuery.cookie("timeformat");if(isNaN(times)||!set_date){if(timefomat==0){alert(Language.Validate['010']);}else if(timefomat==1){alert(Language.Validate['011']);}else{alert(Language.Validate['009']);}return false;}var dateTime={"data":{"present_time":times}};return dateTime},specialtime:function(timeStr){var timefomat=jQuery.cookie("timeformat");var inputtime="";if(timeStr.indexOf("-")>-1){inputtime=timeStr.replace(/-/g," ").split(" ")}else{inputtime=timeStr.replace(/\//g," ").split(" ")}switch(Number(timefomat)){case 0:timeStr=inputtime[2]+"-"+inputtime[1]+"-"+inputtime[0]+" "+inputtime[3];break;case 1:timeStr=inputtime[2]+"-"+inputtime[0]+"-"+inputtime[1]+" "+inputtime[3];break};return timeStr},testformat:function(formattype){var timefomat=jQuery.cookie("timeformat");var inputtime="";var isChecked=false;if(formattype.indexOf("-")>-1){inputtime=formattype.replace(/-/g," ").split(" ")}else{inputtime=formattype.replace(/\//g," ").split(" ")}if(timefomat==0){if(inputtime[0]<1||inputtime[0]>31){isChecked=true}if(inputtime[1]<1||inputtime[1]>12){isChecked=true}}else if(timefomat==1){if(inputtime[0]<1||inputtime[0]>12){isChecked=true}if(inputtime[1]<1||inputtime[1]>31){isChecked=true}}if(inputtime[2]<1970){isChecked=true}if(inputtime[3]<0||inputtime[3]>23||!inputtime[3]){isChecked=true}if(isChecked){alert(Language.Validate["007"]);return false}else{return true}},adunit:function(unit){if(unit.indexOf("deg.")>-1){unit=unit.replace("deg.","°")}return unit},header:function(data){var logout=$("#headerLogout");logout.off("click").on("click",function(){if(confirm(Language.Html['012'])){Control.LoginOut()}return false});Configs.protocol_type=data.data.protocol_type?data.data.protocol_type:0;this.SetCommons()},sider:function(data){var siderList=$("#sider ul.sider-list");this.SetCommons();this.bindEvent("click",siderList,"a");var SiderInfoList=$("div.sider-info").find("dl");SiderInfoList.find("dd:odd").css({"background":"#D4E0EF"}).end().find("dd:even").css({"background":"#EAF0F7"});var LinkToACU=document.getElementById("LinkToACU");if(LinkToACU){var that=this;$(LinkToACU).off().on("click",function(){if(!(/IE/g.test(Configs.Browser))){alert(Language.Html['048']);return false}that.SetProcess(Language.Html['049']);var XHR=$.ajax({timeout:Configs.Data.timeout,url:"/cgi-bin/web_cgi_main.cgi?user_name="+jQuery.cookie("user_name")+"&user_password="+jQuery.cookie("user_password")+"&language_type="+jQuery.cookie("language_type")+"&_"+new Date().getTime(),success:function(data,textStatus,jqXHR){jQuery.cookie("acuIP",window.location.hostname,{path:"/"});that.SetProcessRemove();var LinkOldPage=window.open('/cgi-bin/eng/p01_main_frame.htm');LinkOldPage.opener=null;LinkOldPage=null},error:function(data,textStatus){that.SetProcessRemove();alert(Language.Html['050'])}}).always(function(jqXHR,textStatus,errorThrown){jqXHR=null;textStatus=null;errorThrown=null;XHR=null});return false})}},SetCommons:function(data){var SideSite=$("#SideSite"),SideVoltage=$("#SideVoltage"),SideCurrent=$("#SideCurrent"),SideConverterVoltage=$("#SideConverterVoltage"),SideConverterCurrent=$("#SideConverterCurrent"),SiteName=$("#SiteName"),SiteLocation=$("#SiteLocation");var data=Configs.Alarm.data;var lang=jQuery.cookie("language_type");if(SiteLocation[0]&&SiteName[0]&&SideSite[0]&&data.site){SiteName.html(data.site[0][lang]);SiteLocation.html(data.site[1][lang]);SideSite.html(data.site[2][lang])};if(SideCurrent[0]&&SideVoltage[0]&&data.status){SideVoltage.html(Validates.CheckValueReturn(data.status[0],"V"));SideCurrent.addClass(Validates.CheckValue(data.status[1],true));SideCurrent.html(Validates.CheckValueReturn(data.status[1],"A"))}if(SideConverterVoltage[0]&&SideConverterCurrent[0]&&data.converter){SideConverterVoltage.html(Validates.CheckValueReturn(data.converter[0],"V"));SideConverterCurrent.addClass(Validates.CheckValue(data.converter[1],true));SideConverterCurrent.html(Validates.CheckValueReturn(data.converter[1],"A"))}},alarm:function(data){var that=this;var alarm=$("#alarm");var mainContent=$("#mainContent");var content=$("#content");var autoAlarm=$("#autoAlarm");var alarm_list=$("#alarmList div.tab_item");var alarmTab=alarm.find("ul.alarm-tab");var alarmTip=$("#alarmTip");var alarmHandle=alarm.find("a.alarmHandle");var alarmtype=[];for(var i=0;i<data.Content.length;i++){if((data.Content[i][0]==1&&$.inArray(1,alarmtype))||(data.Content[i][0]==2&&$.inArray(2,alarmtype))||(data.Content[i][0]==3&&$.inArray(3,alarmtype))){alarmtype.push(data.Content[i][0])}}if($.inArray(3,alarmtype)>-1){alarmTip.attr("class","h-s-alarm3")}else if($.inArray(2,alarmtype)>-1){alarmTip.attr("class","h-s-alarm")}else if($.inArray(1,alarmtype)>-1){alarmTip.attr("class","h-s-alarm1")}else{alarmTip.attr("class","h-s-ok")}var H_alarmMax=198;var H_alarmMin=28;alarmHandle.off().on("click",function(event,index){Configs.startTime=Number(new Date().getTime());Configs.Alarm.show=Configs.Alarm.expand?false:!Configs.Alarm.show;Configs.Alarm.expand=false;$(".alarm-tab li").eq(Configs.Alarm.tab).removeClass("current");Configs.Alarm.tab="";Control.SetLayout();Control.RefreshModule(Configs.refresh);return false});alarmTab.find("li.alarmPop").off().on("click",function(){if(!Configs.Alarm.show){Configs.Alarm.show=true;Control.SetLayout()}else{if(Configs.Alarm.tab==$(this).index()){Configs.startTime=Number(new Date().getTime());Configs.Alarm.show=Configs.Alarm.expand?false:!Configs.Alarm.show;Configs.Alarm.expand=false;Configs.Alarm.tab="";Control.SetLayout();Control.RefreshModule(Configs.refresh);return false}}Configs.Alarm.tab=$(this).index()});$(alarm).off().Tabs({event:'click',currentTab:Configs.Alarm.tab,handle:alarm.find('div.alarm-bar'),content:alarm.find('div.alarm-content')});var alarmAutoPop=jQuery.cookie("alarmAutoPop");$(autoAlarm).prop("checked",Boolean(Number(alarmAutoPop)));$(autoAlarm).off().on("click",function(){jQuery.cookie("alarmAutoPop",Number($(this).prop("checked")),{path:"/"})});if(!Configs.Alarm.show){var DatasPolling=true;if(Configs.Data.polling){DatasPolling=Control.isPolling}if(Number(alarmAutoPop)==1&&DatasPolling){if(data.Content.length>Configs.Alarm.cacheLength){alarmHandle.trigger("click");$(".alarmPop").eq(0).addClass("current");Configs.Alarm.show=true}else{alarmHandle.addClass("alarmOpen")}}}else{var currentcount=0;$.each($(".alarmPop "),function(){if($(this).hasClass("current")){currentcount++}});if(currentcount==0){$(".alarmPop").eq(0).addClass("current")}}Configs.Alarm.cacheLength=data.Content.length;var alarmList=$("#alarmList");var alarmpopup=alarmList.find("div.alarm-popup");alarmList.off().on("scroll",function(){Configs.Alarm.scrollHeight=$(this).scrollTop();alarmpopup.hide()});alarmList.scrollTop(Configs.Alarm.scrollHeight);if(Configs.Alarm.expand){Control.SetLayout(true)}alarmList.find("ul li.alarm-tip").off().on("click","i",function(){that.PopupInfo("#alarmList","click","i",["div.alarm-popup"],{info:$(this).attr("info"),alarm:true,hide:true})});Configs.Sider.Controller=data.controller;SetSiderController();var do_sider=setInterval(function(){SetSiderController()},300);function SetSiderController(){var controllers=$("dd.SiderController");if(controllers.length==0){return}var hidden=0;for(var i=0,ilen=controllers.length;i<ilen;i++){if(data.controller[i]!=0&&controllers.eq(i)[0]){controllers.eq(i).find("em").html(data.controller[i]).end().show();controllers.eq(i).css({"background":i%2==(hidden%2==0?1:0)?"#EAF0F7":"#D4E0EF"})}else{controllers.eq(i).hide();hidden++}};$("#siderinfo").children("dd,dl").remove();$("#siderinfo").append($("#sider div").eq(0).html()).addClass("sider-info");Control.SetLayout();clearInterval(do_sider);do_sider=null}},mainBar:function(){var nav=$("div.mainBar-nav");this.bindEvent("click",nav,"a")},HomeTrend:function(target){var data=Configs.Trend.data;var data_y=Configs.Trend.data_y;data.canvas={};data.canvas.width=Configs.TrendCvWidth;data.canvas.height=110;data['fn_nodata']=function(){var AverageCurrent=$("#AverageCurrent")[0];if(AverageCurrent){AverageCurrent.innerHTML="---"}};data['fn']=function(){var AverageCurrent=$("#AverageCurrent");var v_checkclass=Validates.CheckValue(data.averageCurrent);AverageCurrent.parent("p").attr("class",v_checkclass);if(AverageCurrent[0]){AverageCurrent[0].innerHTML=data.averageCurrent+"A"}};Chart.drawCurve("Trend",data,data_y);if(data.peakCurrent){var PeakCurrent=document.getElementById("PeakCurrent");var PeakCurrentTime=document.getElementById("PeakCurrentTime");if(PeakCurrent){PeakCurrent.innerHTML=data.peakCurrent[0]}if(PeakCurrentTime){PeakCurrentTime.innerHTML=data.peakCurrent[1]}}},GetCurveData:function(args){var that=this;var url=(args&&args["url"])?args["url"]:"/var/datas/data.hybrid.html";var name=(args&&args["name"])?args["name"]:null;var XHR=$.ajax({timeout:Configs.Data.timeout,url:url+"?_"+new Date().getTime(),beforeSend:function(){Control.PromptEvent.Loading({target:"PromptPop",marginTop:"center",clear:false})},success:function(data,textStatus,jqXHR){var re=new RegExp(Configs.Data.endStr,'g');if(re.test(data)){Configs.Data.complete=true;data=data.replace(Configs.Data.endStr,"")}else{Control.PromptEvent.Tip({target:"PromptPop",text:Language.Html['005'],marginTop:"center"});return};try{data=jQuery.evalJSON(data);if(name!=null){data=data[name]}data=$.extend(true,data,args["setting"]);setTimeout(function(){Chart.drawCurve("Pop"+name+"Curve",data);Control.PromptEvent.LoadingRemove({remove:"PromptPop"})},100)}catch(Error){Control.PromptEvent.Tip({target:"PromptPop",text:Language.Html['001'],marginTop:"center"});return}},error:function(data,textStatus){Control.PromptEvent.Tip({target:"PromptPop",text:Language.Html['021'],marginTop:"center"})}}).always(function(jqXHR,textStatus,errorThrown){jqXHR=null;textStatus=null;errorThrown=null;XHR=null})},PopTimer:null,PopupInfo:function(target,evt,ele,id,data){var popup=id==null?null:$(id[0]);var mainBody=$("#mainBody");var template="";if(popup&&popup[0]){template=doT.templateChild(popup.attr("template"))}if(data.close===true){template+="<a class='popup-close' id='BtnPopupClose' href='#'></a>"}var doTtmpl=doT.template(template);if(data.isAbsoluteCenter&&$.type(data.isAbsoluteCenter)=="array"&&data.isAbsoluteCenter[0]==true){var mainBodyHeight=mainBody.height();var mainBodyWidth=mainBody.width();var absObjct=data.isAbsoluteCenter[1];var absObjctHeight=absObjct.height();var absObjctWidth=absObjct.width()}var that=this;$(target).off().on(evt,ele,function(event,trigger){var $this=$(this);if(data.parent){if(data.parent===true){$this=$(this).parent()}else{$this=$(this).closest(data.parent)}};if(data.fn&&$.type(data.fn)=="function"){data.fn($this);return false}if(!$(target)[0]||!popup){return false}if($this.hasClass("off")){return}var index=$this.index();var interval=0;if(data.alarm===true){interval=100}else{if(evt!="click"){interval=500}if(data.interval){interval=data.interval}}if(that.PopTimer!=null){clearTimeout(that.PopTimer)};data.index=index;data=$.extend(true,{},data,{"dataIndex":$(this).attr("index"),"dataKey":$(this).attr("name")});$.extend(true,Configs.Popup.Data,data);popup.html(doTtmpl(data));that.PopTimer=setTimeout(function(){doShow()},interval);function doShow(){if(data.close===true){var BtnClosePopup=popup.find("#BtnPopupClose");that.PopupClose(popup,BtnClosePopup)}Configs.Popup.index=index;Configs.Popup.status=true;var PopupContent=popup.find("div.popup-content");var PopupAlarm=popup.find("div.alarm-popup");var PopupWidth=popup.outerWidth(true);var PopupHeight=popup.outerHeight(true);var thisWidth=$this.width();var thisLeft=$this.position().left;var thisTop=$this.position().top;var thisHeight=$this.outerHeight(true);var mainScrollTop=mainBody.scrollTop();var top=thisTop-PopupHeight+mainScrollTop;if(data.alarm){top=thisTop-PopupHeight;PopupContent.css("text-align",PopupHeight>90?"left":"center");PopupAlarm.css("text-align",PopupHeight>90?"left":"center")}if(data.isAbsoluteCenter){var w=mainBodyWidth/2-absObjctWidth/2;thisLeft=thisLeft+w;var parent=$this.parent();var isCenter=($this.parent().attr("iscenter")==1)&&mainBody[0]&&absObjct[0];if(isCenter){var h=mainBodyHeight/2-absObjctHeight/2;thisTop=thisTop+h}};var arrow=popup.find("div.popup-arrow");var maxtop=popup.height();var arrowTop=popup.find("div.popup-arrow-top");if(thisTop-maxtop-mainScrollTop<0){Configs.Popup.Arrow="top";if(arrowTop.length>0){top=top+thisHeight+maxtop+(isCenter?2:7)-mainScrollTop;arrow.remove();arrow=arrowTop;arrow.show();if(BtnClosePopup){BtnClosePopup.removeClass("popup-close-b").addClass("popup-close-t")}}}else{Configs.Popup.Arrow="bottom";arrowTop.remove();if(arrowTop.length>0){top-=(isCenter?7:-10+mainScrollTop)}if(BtnClosePopup){BtnClosePopup.removeClass("popup-close-t").addClass("popup-close-b")}}var arrowWidth=arrow.width();var arrowLeft=function(n){return Math.floor(thisLeft-n+(thisWidth-arrowWidth)/2)};var left=thisLeft-(PopupWidth-thisWidth)/2;var maxr=data["maxr"]?(Number(data["maxr"])<767?767:Number(data["maxr"])):767;if(data.system){left=5}else if(left<0){left=1}else if(left+PopupWidth>maxr){left=maxr-PopupWidth}var deviceindex=index+1;if(jQuery.cookie("systeminfo")==1){if(deviceindex%4==0){left=left+100}}else{if(deviceindex%5==0||(deviceindex+1)%5==0){left=left+300}}popup.css({"top":top+(isCenter?h:0),"left":left}).show();if(!data.alarm){arrow.css({"margin-left":arrowLeft(left)})}arrow.css({"visibility":"visible"});Configs.Popup.Style=[popup.attr("style")];Configs.Popup.Style.push(arrow.attr("style"));if(data.close===true&&BtnClosePopup[0]){Configs.Popup.CloseHtml=BtnClosePopup[0].outerHTML}};return false}).on("mouseleave",ele,function(){if(data.hide){popup.hide();Configs.Popup.index=null;Configs.Popup.status=false;if(that.PopTimer){clearTimeout(that.PopTimer)}}});if(popup&&popup[0]){popup.off().on("mouseenter",function(){that.SystemPop=false}).on("mouseleave",function(){if(data.hide){$(this).hide()}that.SystemPop=true})}},PopupClose:function(popup,BtnClosePopup){var BtnPopupClose=BtnClosePopup?BtnClosePopup:$(popup).find("#BtnPopupClose");if(BtnPopupClose[0]){BtnPopupClose.off().one("click",function(){$(popup).hide();Configs.Popup.index=null;Configs.Popup.status=false;return false})}},SystemPop:true,SystemDrawMeter:function(target,data){var meterDatas={center:[165,135],background:{radius1:55,radius2:45},finger:{angle:[180,30],width:[11,20],radius:46},alarm:{outer:{value:data.data.group.chart["value_alarm"],color:["#a2ee00","#ffae00","#e35500"],radius:90},inner:{value:[0,70,85,120],radius:52}},value:{outer:data.data.group.chart['used_cap'],inner:data.data.group.chart['volt'],innerA:data.data.group.chart['curr'],toFix:[0],unit:["%"]}};Chart.drawMeter(target,meterDatas)},SystemCommon:function(data){var mainBody=$("#mainBody");if($("a.system_set_btn").length>0){$("div.system-list>ul>li").off().on("mouseenter",function(){if($(this).hasClass("off")){return false}$(this).find("a.system_set_btn").show()}).on("mouseleave",function(){$(this).find("a.system_set_btn").hide()})};var that=this;if(that.SystemSroll>0){setTimeout(function(){mainBody.scrollTop(that.SystemSroll);that.SystemSroll=0},1)};var operation=[];for(var h=0,hlen=data.data.headline.length;h<hlen;h++){var itemlen=data.data.headline[h].length;operation[h]=data.data.headline[h][itemlen-2]+"-"+data.data.headline[h][itemlen-1]};var list=$("div.system-list,div.system-summary");var detail=$("#SystemDetail");Configs.Popup.Data={headline:data.data['headline'],operation:operation,single_data:data.data['single_data'],system:true,close:true};this.PopupInfo("div.system-list","click","li",["#popup"],Configs.Popup.Data);this.PopupClose("#popup");$("#closeDetail").off().on("click",function(){$("#mainTab>a.currentMenu").click();return false});$("div.system-list>ul").off().on("click","a.system_set_btn",function(){var $this=$(this).parent();that.SystemSroll=mainBody.scrollTop();detail.show();list.hide();Control.GetTemplate(jQuery.evalJSON($this.find("a.system_set_btn").attr("data").replace("{,","{")));return false})},SystemSroll:0,SetSettingDate:function(seconds){var setTime=new Date(1000*(seconds+Configs.timezone*3600));var setTimeStr=setTime.getFullYear()+"-"+Validates.MakeupZero(setTime.getMonth()+1)+"-"+Validates.MakeupZero(setTime.getDate())+" "+Validates.MakeupZero(setTime.getHours())+":"+Validates.MakeupZero(setTime.getMinutes())+":"+Validates.MakeupZero(setTime.getSeconds());return setTimeStr},DoRestart:function(restart,time,text,fn){var that=this;var NeedRestart=(restart===false)?false:true;if(NeedRestart){jQuery.cookie("restart","1",{path:"/"});Control.StopKeepLogin();Control.StopPollingAlarm();Control.StopPolling()};var RestartTimes=(time&&$.type(time)=="number")?time:Configs.RestartTime;var Tips=$("#SetProgress"),TipsEm=Tips.find("em").eq(0);if(NeedRestart){TipsEm.html(Language.Html["041"]+" <span id='TimerCount'>"+RestartTimes+"</span>"+Language.Html["042"]+Language.Html["054"])}else{TipsEm.html((text?text:"")+" <span id='TimerCount'>"+RestartTimes+"</span>"+Language.Html["042"])}that.SetProcessPosition();var RestartNow=false;TimerAction();var RestartXHR=null;var TimerCount=$("#TimerCount");var minWait=0;function TimerAction(){if(NeedRestart&&RestartTimes>0&&RestartTimes%5==0&&minWait>15){if(RestartXHR){RestartXHR.abort();RestartXHR=null}RestartXHR=$.ajax({url:"/var/datas/data.login.html?_="+new Date().getTime(),timeout:Configs.Data.timeout,success:function(data,textStatus,jqXHR){var re=new RegExp("\"%__data_end__%\"",'g');if(re.test(data)){data=data.replace("\"%__data_end__%\"","");try{var data=jQuery.evalJSON(data);RestartNow=true}catch(e){}}}}).always(function(jqXHR,textStatus,errorThrown){jqXHR=null;textStatus=null;errorThrown=null;RestartXHR=null})};var Timer=setTimeout(function(){RestartTimes--;minWait++;if(RestartTimes==0||RestartNow===true){clearTimeout(Timer);if($.type(fn)=="function"){fn()}if(NeedRestart){TipsEm.html(Language.Html["043"]);location.href=Configs.login+"?"+new Date().getTime()}that.SetProcessPosition()}else{TimerCount.html(RestartTimes);TimerAction()}},1000)}},SetProcess:function(text,close,cla,callback){Configs.Backspace=false;var that=this;var c=(close===false)?close:true;var c_html="";if(c){c_html=Configs.Prompt.cancel}Control.PromptEvent.Cover();$("div.SetProgress").remove();$("body").append("<div class='SetProgress"+(cla?" "+cla:"")+"' id='SetProgress'><div class='SetProgressContent' id='SetProgressContent'><em>"+text+"</em>"+c_html+"</div></div>");if(c){var CloseButton=$("#SetProgress").find("a.close");CloseButton.one("click",function(){that.SetProcessRemove();if($.type(callback)=="function"){callback()}})}this.SetProcessPosition();return this},SetProcessPosition:function(){var SetProgress=$("#SetProgress");var width=SetProgress.innerWidth();var siderwidth=96;if(jQuery.cookie("systeminfo")==1){siderwidth=siderwidth-239}SetProgress.css({"margin-left":(-width+siderwidth)/2})},SetProcessRemove:function(){Control.RemoveFrames();var cover=$("#PromptCover"),loading=$("#SetProgress");cover.remove();loading.remove()},SetProcessStart:function(){$("#SetProgress").find("em").html(Language.Html['011'])},GetProcess:function(){var doc=document;var SetProgress=doc.getElementById("SetProgress");if(!SetProgress){this.SetProcess("");SetProgress=doc.getElementById("SetProgress")};return $(SetProgress)},SetProcessDone:function(text,callback,data){var that=this;var SetProgress=this.GetProcess();var Error=SetProgress.find("em");Error.html(text);if($.type(callback)=="function"){Error.append(Configs.Prompt.retry)}SetProgress.find("a").css("display","inline-block");this.SetProcessPosition();var Retry=SetProgress.find("a.resetSendSubmit");Retry.one("click",function(){if($.type(callback)=="function"){if(data){callback(data)}else{callback()}that.SetProcessPosition()}})},SetProcessOK:function(text,interval){var SetProgress=this.GetProcess();var Error=SetProgress.find("em");var Btn=SetProgress.find("a");var isIE6=/IE6/g.test(Configs.Browser);Error.html(text);Btn.remove();var Cover=$("#PromptCover");if(isIE6){Cover.css({"opacity":0})}else{Cover.remove()}if(!interval){var interval=500}setTimeout(function(){SetProgress.fadeOut(500,function(){SetProgress.remove();if(isIE6){Cover.remove()}})},interval);this.SetProcessPosition()},FixThead:function(tableid,createid,scroll,initTop){if(/IE6|IE7|IE8/g.test(Configs.Browser)){return false}var doc=document,target=$(doc.getElementById(tableid));if(!target[0]){return false}var isHas=doc.getElementById(createid);if(isHas){var fixed=$(isHas)}else{var table=$(doc.createElement("table")),header=target.find("thead").eq(0).clone(),fixed=$(doc.createElement("div"));table.attr({"border":0,"cellspacing":0,"cellpadding":0,"class":target[0].className}).css({"border-top":"none"}).html(header);fixed.attr({"id":createid,"class":"table-thead"}).html(table)};var offset=target.offset(),left=offset.left,top=offset.top,scroll2=target.parent().position().top+scroll,initTop=initTop?initTop:166,scrollLeft=$(doc).scrollLeft();if(scroll>scroll2){fixed.css({"left":left-scrollLeft,"top":initTop-Configs.bodyScroll}).insertBefore(target).show()}else{fixed.hide()}},moveCursorToEnd:function(el){el.focus();if(typeof el.selectionStart=="number"){el.selectionStart=el.selectionEnd=el.value.length}else if(typeof el.createTextRange!="undefined"){var range=el.createTextRange();range.collapse(false);range.select()}return $(el)}};
/*!
 * Author: Jerman.Xie | xieguishi@126.com
 * Date: 2013.09
 *
 * Form表单验证
 */
;var Validates={MakeupZero:function(num){if(num==0){return"00"}if(num<10){return"0"+num}else{return num}},Atoi:function(str){if(isNaN(str)){return 0};var s1="",i,c;for(i=0;i<str.length;i++){c=""+str.charAt(i);if(c!="0"){break}};if(i==str.length){return 0};for(;i<str.length;i++){s1=s1+str.charAt(i)};return parseInt(s1)},ConvertIP:function(ip){if(isNaN(ip)){ip=this.Atoi(ip)};var strIP=""+((ip)&0xff)+"."+((ip>>8)&0xff)+"."+((ip>>16)&255)+"."+((ip>>24)&255);return strIP},ParseIntIP:function(ip){if(!this.CheckIP(ip)){return 0}var myArray=ip.split(/\./);var ip=0,i;for(i=0;i<4;i++){ip<<=8;ip+=this.Atoi(myArray[i])}return ip},CheckIP:function(what,zero){if(what.search(/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/)==-1){return false}var myArray=what.split(/\./);var CheckZero=false;for(var i=0;i<4;i++){if(!CheckZero){if(myArray[i]>0){CheckZero=true}}if(isNaN(myArray[i])){return false}var t=this.Atoi(myArray[i]);if((t<0)||(t>255)){return false}}if(!zero){if(!CheckZero){return false}}return true},CheckIPV6:function(ipv6,port){if(!ipv6){return false}ipv6=$.trim(ipv6);var reg=/(^\s*((([0-9A-Fa-f]{1,4}:){7}([0-9A-Fa-f]{1,4}|:))|(([0-9A-Fa-f]{1,4}:){6}(:[0-9A-Fa-f]{1,4}|((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9A-Fa-f]{1,4}:){5}(((:[0-9A-Fa-f]{1,4}){1,2})|:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9A-Fa-f]{1,4}:){4}(((:[0-9A-Fa-f]{1,4}){1,3})|((:[0-9A-Fa-f]{1,4})?:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){3}(((:[0-9A-Fa-f]{1,4}){1,4})|((:[0-9A-Fa-f]{1,4}){0,2}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){2}(((:[0-9A-Fa-f]{1,4}){1,5})|((:[0-9A-Fa-f]{1,4}){0,3}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){1}(((:[0-9A-Fa-f]{1,4}){1,6})|((:[0-9A-Fa-f]{1,4}){0,4}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(:(((:[0-9A-Fa-f]{1,4}){1,7})|((:[0-9A-Fa-f]{1,4}){0,5}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:)))(%.+)?\s*$)/gi;if(port){if(ipv6[0]!=="["||!(/\]:/g.test(ipv6))){return false}var ip=ipv6.split("]:"),port=parseInt(ip[1]);ipv6=ip[0].replace("[","");if(!reg.test(ipv6)||(ip[1]==""||port<0||port>65534)){return false}}else{if(!reg.test(ipv6)){return false}}return true},MakeTimeZoneInfo:function(nTimeZone){var nTZ,buf;if(isNaN(nTimeZone)){nTimeZone=-28800};buf="GMT";buf+=""+((nTimeZone>0)?'-':'+');nTZ=(nTimeZone>0)?nTimeZone:-nTimeZone;var hr=Math.floor(nTZ/3600);var mn=Math.floor((nTZ%3600)/60);buf+=""+((hr>=10)?hr:"0"+hr)+":"+((mn>=10)?mn:"0"+mn);return buf},ParseTimeZoneInfo:function(zi){var nSign,nHr=0,nMin=0,i;if((zi==null)||(zi.length==0)){return-1};if((zi.charAt(0)!="G")&&(zi.charAt(0)!="g")&&(zi.charAt(1)!='M')&&(zi.charAt(1)!='m')&&(zi.charAt(2)!='T')&&(zi.charAt(2)!='t')){return-1};if(zi.length==3){return 0};if(zi.charAt(3)=='+'){nSign=-1}else if(zi.charAt(3)=='-'){nSign=+1}else{return-1}i=4;var c=zi.charAt(i);if((c>="0")&&(c<="9")){nHr=parseInt(c);i++}else{return-1};c=zi.charAt(i);if((c>="0")&&(c<="9")){nHr=nHr*10+parseInt(c);i++};if(nHr>=24){return-1};if(zi.length==i){return nSign*nHr*3600};if(zi.charAt(i)!=':'){return-1};i++;c=zi.charAt(i);if((c>="0")&&(c<="9")){nMin=parseInt(c);i++}else{return-1};c=zi.charAt(i);if((c>="0")&&(c<="9")){nMin=nMin*10+parseInt(c);i++};if(nMin>=60){return-1};return nSign*(nHr*3600+nMin*60)},CheckDate:function(obj){var monthDay=new Array(31,28,31,30,31,30,31,31,30,31,30,31);var month,day,year,retval=false;if(obj==""){return false};obj=$.trim(obj);if(obj!=""){var a=obj.split("/");if(a.length==3&&a[0]!=""&&a[1]!=""&&a[2]!=""){if(a[0].length>4||a[1].length>2||a[2].length>2){return false}month=a[1];var t=this.Atoi(month);if(!isNaN(month)&&t>0&&t<=12){month=t;year=a[0];if(!isNaN(year)&&this.Atoi(year)>=1900&&this.Atoi(year)<=9999){day=a[2];if(!isNaN(day)){day=this.Atoi(day);t=monthDay[month-1];if(month==2)t+=this.CheckLeapYear(year);if(day>0&&day<=t){retval=true}}}}}}return retval},CheckTime:function(obj){if(obj==""){return false};obj=$.trim(obj);var a=obj.split(":");if(a.length>3){return false};var hours=a[0];var minutes=a.length>=2?a[1]:"0";var seconds=a.length>2?a[2]:"0";if((hours.length>2)||(hours.length==0)||(minutes.length>2)||(minutes.length==0)||(seconds.length>2)||(seconds.length==0)){return false}var t=this.Atoi(hours);if(!isNaN(hours)&&t>=0&&t<24){if(!isNaN(minutes)){minutes=this.Atoi(minutes);if(minutes>=0&&minutes<=59){t=this.Atoi(seconds);if(!isNaN(seconds)&&t>=0&&t<=59){return true}}}}return false},CheckDateTime:function(target,obj){var time=$(target).val();time=this.RedDateTime(time).replace(/-/g,"/");if(!/ /gi.test(time)){return false}var date_time=time.split(" ");var new_date=[];for(var i=0,ilen=date_time.length;i<ilen;i++){if(date_time[i]!=""){new_date.push(date_time[i])}}if(obj){$(target).val(Pages.footer(Pages.changetime(time),"page").replace(/-/g,"/"))}else{$(target).val(new_date.join(" "))}if(this.CheckDate(new_date[0])&&this.CheckTime(new_date[1])){return true}return false},RedDateTime:function(datetime){if(datetime==undefined){return"NAN"}else{var year,month,day,hour,minute,second;var timefomat=jQuery.cookie("timeformat");if(timefomat==2){return datetime}else{if(datetime.indexOf("-")>-1){datetimearry=datetime.split("-")}else{datetimearry=datetime.split("/")}datetimearry2=datetime.split(":");year=datetimearry[2].substring(0,4);if(timefomat==0){month=datetimearry[1];day=datetimearry[0]}else{month=datetimearry[0];day=datetimearry[1]}hour=datetimearry2[0].substring(datetimearry2[0].length-2,datetimearry2[0].length);minute=datetimearry2[1];second=datetimearry2[2];if(datetime.indexOf("-")>-1){return year+"-"+month+"-"+day+" "+hour+":"+minute+":"+second;}else{return year+"/"+month+"/"+day+" "+hour+":"+minute+":"+second;}}}},CheckLeapYear:function(year){var y=0;if((year%4==0)&&!(year%400!=0&&year%100==0)){y=1};return y},CheckSetting:function(input,validate,value){var value=$.trim(value);switch(validate.type){case 1:if(value==""){alert(Language.Validate['001']);input.focus();return false}else if(isNaN(value)||!(/^[0-9]*[^\.][0-9]*$/gi.test(value))){alert(Language.Validate['002_int']);input.focus();return false}else if(value<validate.range[0]||value>validate.range[1]){alert(Language.Validate['003']);input.focus();return false}break;case 2:if(value==""){alert(Language.Validate['001']);input.focus();return false}else if(isNaN(value)){alert(Language.Validate['002_float']);input.focus();return false}else if(value<validate.range[0]||value>validate.range[1]){alert(Language.Validate['003']);input.focus();return false}break;case 3:if(value==""){alert(Language.Validate['001']);input.focus();return false}else if(isNaN(value)||!(/^-*[0-9]*[^\.][0-9]*$/gi.test(value))){alert(Language.Validate['002_unsigned_int']);input.focus();return false}else if(value<validate.range[0]||value>validate.range[1]){alert(Language.Validate['003']);input.focus();return false}break;case 4:if(value==""){alert(Language.Validate['001']);input.focus();return false}else{if(validate.date){if(value.indexOf("-")>-1){value=$.trim(value).replace(/-/g," ").split(" ")}else{value=$.trim(value).replace(/\//g," ").split(" ")}var newValue=[];for(var item in value){if(value[item]!=""){newValue.push(value[item])}}value=newValue;var Max_len=3;if(value[0]>1969)Max_len=4;if(value.length>Max_len){alert(Language.Validate["007"]);return}var validate=validate.date.split("-");var isChecked=false;if(value.length==validate.length){if(value[0]>1969){if(!this.CheckDate("2008/"+value[1]+"/"+value[2])){alert(Language.Validate["007"]);return}}else{if(!this.CheckDate("2008/"+value[0]+"/"+value[1])){alert(Language.Validate["007"]);return}}for(var i=0,ilen=validate.length;i<ilen;i++){if(validate[i]=="mm"){if(value[i]<1||value[i]>12){alert(Language.Validate["007"]);isChecked=true;break}}else if(validate[i]=="dd"){if(value[i]<1||value[i]>31){alert(Language.Validate["007"]);isChecked=true;break}}else if(validate[i]=="hh"){if(value[i]<0||value[i]>23){alert(Language.Validate["007"]);isChecked=true;break}}else if(validate[i]=="yy"){if(value[i]<1970){alert(Language.Validate["007"]);isChecked=true;break}}};if(isChecked){return false}}else{alert(Language.Validate["007"]);return false}}}break;case 5:break;case"sitename":if(value==""){alert(Language.Validate['001']);input.focus();return false}else{var reg=/["\/<>&#!\\]/g;if(reg.test(value)){alert(Language.Validate['008']);return false}}break};return true},CheckReg:function(input,reg,text){var reg=new RegExp(reg);if(!reg.test(input.val())){alert(text);input.focus();return false}return true},CheckValue:function(data1,data2,relation,show){if(data1&&$.type(data1)!="array"){return""}var v_class="";function GetColor(d){var vclass="";if(d[1]==1){vclass=1}if(d[2]==1){vclass=2}if(d[3]==1){vclass=3}return vclass}var v1_class=GetColor(data1);var v2_class=-1;if(data2){v2_class=GetColor(data2);if(!relation){if(v1_class==1||v2_class==1){v_class="v_alarm"}if(v1_class==2||v2_class==2){v_class="v_disabled"}if(v1_class==3||v2_class==3){if(data2===true){v_class=""}else{v_class="v_hidden"}}}else{if(v1_class==1&&v2_class==1){v_class="v_alarm"}if(v1_class==2&&v2_class==2){v_class="v_disabled"}if(v1_class==3&&v2_class==3){if(show===true){v_class=""}else{v_class="v_hidden"}}}}else{if(v1_class==1){v_class="v_alarm"}if(v1_class==2){v_class="v_disabled"}if(v1_class==3){v_class="v_hidden"}}return v_class},CheckValueReturn:function(value,unit,ins){if(!value){return}var cla=this.CheckValue(value);if(cla=="v_disabled"){return!ins?"<ins class='v_disabled'>---</ins>":"---"}else if(cla=="v_hidden"){return!ins?"<ins>---</ins>":"---"}else if(cla=="v_alarm"){return!ins?"<ins class='v_alarm'>"+(value[0]||value||"")+(unit?unit:"")+"</ins>":(value[0]||value||"")+(unit?unit:"")}else{return(value[0]||value||"")+(unit?unit:"")}},MatchNumber:function(str){return str.match(/[\d#]/g).join("")},MatchNum:function(str){return str.match(/[\d]/g).join("")},MatchNumberS:function(str){return str.match(/[\d#]/g).join("")},GetNoTimeZoneTime:function(date){var newdt=new Date();newdt.setFullYear(date.substr(0,4));newdt.setDate(date.substr(8,2));newdt.setMonth(date.substr(5,2)-1);newdt.setHours(date.substr(11,2));newdt.setMinutes(date.substr(14,2));newdt.setSeconds(date.substr(17,2));return Math.floor((newdt.getTime()-newdt.getTimezoneOffset()*60000)/1000)},SetBatteryTime:function(nSec){function makeSampleDateStr(nSec){return""+getSampleCurUTCDate(nSec)+" "+getCurUTCTime(nSec)}function getSampleCurUTCDate(nSec){if(isNaN(nSec)){nSec=this.atoi(nSec);if(isNaN(nSec))nSec=0}var s="-";var d=new Date();if(nSec!=0){d.setTime(nSec*1000)}var dd=d.getUTCDate();var sd=(dd<10)?"0"+dd:""+dd;var m=d.getUTCMonth()+1;var sm=(m<10)?"0"+m:""+m;var strDate=""+d.getUTCFullYear()+s+sm+s+sd;return strDate}function getCurUTCTime(nSec){if(isNaN(nSec)){nSec=this.atoi(nSec);if(isNaN(nSec))nSec=0}var c=":";var d=new Date();if(nSec!=0){d.setTime(nSec*1000)}var s=d.getUTCSeconds();var ss=(s<10)?"0"+s:""+s;var m=d.getUTCMinutes();var sm=(m<10)?"0"+m:""+m;var h=d.getUTCHours();var sh=(h<10)?"0"+h:""+h;var strTime=""+sh+c+sm+c+ss;return strTime}function getShowFormat(varTime){var varFormat1;var year=varTime.substring(0,4);var min=varTime.substring(14,16);var sec=varTime.substring(17,19);if(Number(year)==1972&&Number(min)==7&&Number(sec)==30)varFormat1=varTime.substring(5,13);else varFormat1=varTime.substring(0,13);return varFormat1}var varTempTime;if(nSec>0){varTempTime=makeSampleDateStr(nSec)}else{varTempTime=makeSampleDateStr(63072450)}varValue=getShowFormat(varTempTime);return varValue},CheckEmail:function(obj,reg){if(!obj){return false}var reg_mail=$.type(reg)=="regexp"?reg:/^(\.*[a-zA-Z0-9_-])+@([a-zA-Z0-9_-])+((\.[a-zA-Z0-9_-]{2,100}){1,2})$/gi;if($.type(obj)=="string"){if(!reg_mail.test(obj)){return false}}else{if(!reg_mail.test(obj.val())){if($(obj)[0]){obj[0].select()}return false}}return true}};